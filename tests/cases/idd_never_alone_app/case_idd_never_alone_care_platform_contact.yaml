# Only for physical devices.
# CXTB-399: Verify “Answer Call” for Care Partner Calling Device.
TestAnswerCalForCarePArtnerCallingDeviceCallCompletedESIDDNeverAlone:
  Vars:
    TIME: 5
    INTERFACE: en0
    VIDEO_IN: "1"
    TEST_FOLDER: $AND_CMD_pwd$/Reports/executions/$AND_CMD_date +%s$
  Environment: Settings
  Precases:
    - LoginESIDDNeverAloneHelper
    - ESCarePartnerCleanCallQueueAndHangedCalls
    - IDDESParticipantCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-file-for-fake-audio-capture=$AND_CMD_pwd$/video_audio_samples/sample3.wav
            - use-file-for-fake-video-capture=$AND_CMD_pwd$/video_audio_samples/sample_640x360.mjpeg
      App: desktop
    - Role: command1
      App: command
  Actions:
  # Generate a call to the ES IDD Participant from ES Care Platform.
    - Type: case
      Value: ESCarePartnerCallSenior
  # Device displays an "Incoming Call" prompt, showing the details of who is calling, and giving the option to answer or ignore call.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.incoming_call_header$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.incoming_call_header$
      Attribute: label
      ResultVar: HEADER_TITLE
    - Type: assert
      Asserts:
        - Type: eq
          Var: HEADER_TITLE
          Value: Incoming Call...
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.called_name$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.called_name$
      Attribute: label
      ResultVar: CALLER_VALUE
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALLER_VALUE
          Value: $AND_CLI_es_carepartner_user_name$ $AND_CLI_es_carepartner_user_lastname$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.ignore_call_button$
  # Click on the "Answer Call" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$