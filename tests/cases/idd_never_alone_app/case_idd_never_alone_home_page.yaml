# Only for physical devices.
# CXTB-367: Call Now Button on Home Page for IDD Never Alone.
TestCallNowButtonOnHomePageESIDDNeverAlone:
  Vars:
    TIME: 5
    INTERFACE: en0
    VIDEO_IN: "1"
    TEST_FOLDER: $AND_CMD_pwd$/Reports/executions/$AND_CMD_date +%s$
  Environment: Settings
  Precases:
    - LoginESIDDNeverAloneHelper
    - ESCarePartnerCleanCallQueueAndHangedCalls
    - IDDESParticipantCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
    - Role: command1
      App: command
  Actions:
  # On the Home page, Click the "Call Now" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_home.call_now_button$
  # Device screen updates to show screen to verify you would like to call:
  # Yes, Place Call and Cancel Call
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.yes_place_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.cancel_call_button$
  # Click the "Cancel Call" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.cancel_call_button$
  # Device screen is returned to home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_home.call_now_button$
  # Click the "Call Now" button again.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_home.call_now_button$
  # Device screen updates to show screen to verify you would like to call:
  # Yes, Place Call and Cancel Call
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.yes_place_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.cancel_call_button$
  # Click "Yes, Place Call" button.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.yes_place_call_button$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.yes_place_call_button$
  # Device screen updates showing you the waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_call.waiting_room_label$
  # Care Partner answers the call.
    - Type: case
      Value: AnswerCallAsESCarePartner
  # Turn your camera on using the button along the bottom of the page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$
  # Thumbnail will appear in upper right corner of the video window, indicating your camera is on and giving a preview of what the Care Partner is seeing.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
    # Video Quality Step
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_mirror_care_partner$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.full_screen_call_btn$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.verify_video_is_full_screen$
    # Record the call.
    - Type: case
      Value: GetCallRecordings
    # Analyze the call.
    - Type: case
      Value: AnalyzeRecordings
    # Make video quality assertions
    - Type: case
      Value: VideoQualityAssertions
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.full_screen_call_btn$
  # Click "End Call" button on Participant side.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.end_call_button$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.end_call_button$
  # Call is disconnected and screen updates to show the Post Call Survey.
  # Select any option on the page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
  # Page updates to show Thank you for your feedback message.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.thank_you_label$
  # Do not click the "To Home" button on Thank you for your feedback screen.
    - Type: sleep
      Time: 8
  # Device is automatically returned to home page after a few seconds.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.idd_never_alone_app_home.call_now_button$
  # Care Partner fills in post survey call.
    - Type: case
      Value: PostCallSurveyCarePartner