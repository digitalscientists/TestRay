# CXTB-70: Verify Call Personal Care Partner Button on Page
TestCallPersonalCarePartnerOnHomePage:
  Vars:
    TIME: 5
    INTERFACE: en0
    VIDEO_IN: "1"
    TEST_FOLDER: $AND_CMD_pwd$/Reports/executions/$AND_CMD_date +%s$
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-file-for-fake-audio-capture=$AND_CMD_pwd$/video_audio_samples/sample3.wav
            - use-file-for-fake-video-capture=$AND_CMD_pwd$/video_audio_samples/sample_640x360.mjpeg
      App: desktop
    - Role: command1
      App: command
  Actions:
    # Login to the Care Platform app with Care Partners account.
    - Type: case
      Value: CarePartnerLogin
    # Click on the Call Personal Care Partner button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # Verify that the screen updates to show screen asking what kind of heelp you need:
    # Medical 
    # Non-Medical
    # Cancel Call
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.cancel_call_button$
    # Click on the Cancel Call button and verify that Home page is displayed.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.cancel_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # Click on the Call Personal Care Partner button again.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # Click on the Non Medical call button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
    # Verify that screen redirects to the call waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$

    ## Care partner steps to take the call.
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_home.first_call_of_queue$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_home.answer_call$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_mirror_care_partner$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.full_screen_call_btn$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.verify_video_is_full_screen$
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_call.mute_call_button$
    # Record the call.
    - Type: case
      Value: GetCallRecordings
    # Analyze the call.
    - Type: case
      Value: AnalyzeRecordings
    # Make video quality assertions
    - Type: case
      Value: VideoQualityAssertions
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.full_screen_call_btn$

    # Care partner leaves the call.
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    # Select the Bad option on the Post Survey screen.
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_post_call_survey.bad_answer_button$
    # Verify page updates to ask why you made your selection and presents you with a set of reasons, or gives you option to return to main survey page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.video_quality_not_good_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.could_not_hear_audio_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.problem_was_not_solved_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.issue_with_care_partner_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.call_was_not_answered_option$
    # Click on the back to select button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.back_to_select_button$
    # Select the Ok option.
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_post_call_survey.ok_answer_button$
    # Verify page updates to ask why you made your selection and presents you with a set of reasons, or gives you option to return to main survey page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.video_quality_not_good_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.could_not_hear_audio_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.problem_was_not_solved_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.issue_with_care_partner_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.call_was_not_answered_option$
    # Click on the back to select button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.back_to_select_button$
    # Select the Great option.
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    # Verify page updates and shows Thank You for you feedback page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.thank_you_label$
    # Do not click the "To Home" button on Thank you for your feedback screen.
    - Type: sleep
      Time: 8
    # Verify device is automatically returned to home page after a few seconds.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$

    # End the call on care partner side - Teardown.
    # Fill the notes
    - Type: send_keys
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.subject_input$
      Value: Missed Call Subject Automation
    - Type: send_keys
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.details_textarea$
      Value: Missed Call Details Automation     
    - Type: wait_for_property
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$ 
      Property: disabled
      Value: "false"
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$             
    # Fill the Post-call Survey
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$             
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.issue_resolved_yes_radiobutton$          
    - Type: click
      Role: desktopChrome
      Strategy: id
      Id: $PAGE.care_platform_call_portal.category_select$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_question_option$
    - Type: click
      Role: desktopChrome
      Strategy: id
      Id: $PAGE.care_platform_call_portal.subcategory_select$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.located_provider_option$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_and_exit_session_button$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_notifications.call_completed_notification$

# CXTB-47: Verify in App Offline Behavior
TestVerifyInAppOfflineBehavior:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    # - Role: desktopChrome
    #   App: desktop
  Actions:
    # Navigate to Notifications page.
    - Type: case
      Value: NotificationsPageNavigationHelper
    # Wait for notifications to load before the device goes offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.first_notification$
      Time: 30
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.close_btn$
    # Disconnect from wi-fi to get device offline while viewing the home page.
    - Type: toggle_wifi
      Role: localiOS
    # Verify there is a yellow message bar that indicates that the device is offline and to dial 911 in emergency.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.offline_yellow_bar$
      Time: 30
    # Verify that the call buttons has been replaced with a single gray inactive button saying:
    # "Personal Care Partner and Emergency Services are Offline"
    #TODO: assert the value too.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.offline_call_button$
    #TODO: Verify that the emergency call button disappears.
    # Click an event from the schedule listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.first_event$
    # Verify that a connection error message window appears indicating that the device is offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.connection_header_header_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.device_offline_label$
    # Close the message window.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$  
    # Navigate to Schedules
    - Type: case
      Value: SchedulesPageNavigationHelper
    # Verify there is a yellow message bar that indicates that the device is offline and to dial 911 in emergency.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.offline_yellow_bar$
      Time: 30
    # Verify that the call buttons has been replaced with a single gray inactive button saying:
    # "Personal Care Partner & Emergency Services are Offline"
    #TODO: assert the value too.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.offline_call_button$
    # Click an event from the schedule listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.first_event$
    # Verify that a connection error message window appears indicating that the device is offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.connection_header_header_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.device_offline_label$
    # Close the message window.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$
    # Navigate to Notifications page.
    - Type: case
      Value: NotificationsPageNavigationHelper
    # Click a notification from the notifications listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.first_notification$
    # Verify that a connection error message window appears indicating that the device is offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.connection_header_header_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.device_offline_label$
    # Close the message window.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.close_btn$
  # Connect back the wi-fi to get device online.
    - Type: toggle_wifi
      Role: localiOS