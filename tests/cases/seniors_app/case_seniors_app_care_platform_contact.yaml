# Physical Only
# CXTB-52: Verify "Personal Care Partner Message" Prompt & Call Back Button.
TestPersonalCarePartnerMessagePromptAndCallBackButton:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Go Off Shift"
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop    
  Actions:
  # Send a message to the Senior through the Care Platform logged in as a Care Partner.
    - Type: case
      Value: CarePartnerSendMessageToSenior
  # Device automatically displays "Personal Care Partner Message" window displaying
  # the message sent and indicating the details of who/when sent.
  # TODO: make more assertions on the values.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.message_header$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.message_header$
      Attribute: label
      ResultVar: MESSAGE_HEADER_TITLE
    - Type: assert
      Asserts:
        - Type: eq
          Var: MESSAGE_HEADER_TITLE
          Value: Personal Care Partner Message
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.from_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.sent_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.message_label$
  # Click the "Call Back Personal Care Partner" button.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.call_back_button$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.call_back_button$
      Attribute: label
      ResultVar: CALL_BACK_BUTTON
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_BACK_BUTTON
          Value: Call Back Personal Care Partner
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.call_back_button$
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.call_back_button$
      Time: 10
  # Device screen updates to show screen asking what kind of need you help:
  # Medical, Non-Medical and Cancel
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.cancel_call_button$
  # Click "Medical" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.medical_call_button$
  # User is redirected to the waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
  # Care partner answers call.
    - Type: case
      Value: AnswerCallAsCarePartner
  # Turn on Senior camera.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$
  # Verify that a video tumbnail will appear in the upper right corner giving a preview of what the Care Partner is seeing.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
  # step 6-7 will be skipped

  # Click "End Call".
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_call.end_call_button$
  # Fill in the post call survey with the Great option.
    - Type: case
      Value: SeniorGreatPostSurveyCallHelper
  # Care partner tear down
    - Type: case
      Value: PostCallSurveyCarePartner