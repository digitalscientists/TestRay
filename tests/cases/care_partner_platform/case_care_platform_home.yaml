#CXTB-214: Validating Home elements
TestHomePage:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform.page_title$
      Condition:
      - Value: 2
        Operation: visible
        Result: true
  #Checking Home page and navigation
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Call Queue"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Call Queue"
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_participant$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Participants"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Participants"
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_followup$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Follow-up*"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Follow-up Tickets"
  #Checking Header elements
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.app_logo$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.app_time$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.user_toggle_input$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.headset_icon$
  #Checking options in the user drop-down
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
  #Status
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_away_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
    - Type: wait_for
      Strategy: xpath
  #Other options
      Id: $PAGE.care_platform_header.account_menu_header$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.help_menu_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.myaccount_menu_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.logout_menu_button$

#CXTB-223: Validating changes of status (Not in Call)
TestStatusDropdown_NotInCall:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform.page_title$
      Condition:
      - Value: 2
        Operation: visible
        Result: true
  #Status
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
  #Changing status to away
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_away_button$
  #Navigating to participants page
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_participant$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Participants"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Participants"
  #Checking indicator is set to Away status
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-empty"
  #Trying to change status to In Session (shouldn't let you do it manually)
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
    - Type: click_js
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_followup$
  #Verifying the status indicator didn't change to In Session
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-empty"
  #Changing status back to available
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_followup$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Follow-up*"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Follow-up Tickets"
  #Checking the status indicator correspond to Available
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-green"

#CXTB-227 Account - Update info
TestUpdateInfoAccount:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLoginSecondaryUser
    - Type: case
      Value: CarePlatformUpdateInfo

#CXTB-237 Account - Help
TestAccountHelp:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Going to My Account
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
  #Going to Help
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.help_menu_button$
  #Verify the Help page is visible
    - Type: switch_window
      Value: 1
      CheckTime: 10
    - Type: get_url
      Greps:
        - var: HELP_PAGE_URL
          match: "(.*)care_partner_user_manual(.*).pdf"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: HELP_PAGE_URL
          Value: care_partner_user_manual
        - Type: contain
          Var: HELP_PAGE_URL
          Value: .pdf

#CXTB-236 Account - Update Password
TestUpdatePassword:
  Environment: Settings 
  Vars:
    LOGOUT_OPTION: "Stay On Shift"
    ENV_PASS_STORE: $AND_CLI_carepartner_user1_pwd$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Calling helper to update password
    - Type: case
      Value: CarePlatformUpdatePassword

#CXTB-268 Log Out - Manually of Portal and Go Off Shift
TestLogoutGoOffShift:
  Environment: Settings 
  Vars:
    LOGOUT_OPTION: "Go Off Shift"
    CARE_PARTNER_USER1_FULLNAME: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Clicking the name.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.user_dropdown_button$
  # Click on the logout button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.logout_menu_button$
  # Click on the cancel button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_logout_modal.cancel_logout_button$
  # Calling Logout case.
    - Type: case
      Value: CarePlatformLogout
  # NOTE: Step 7 was skipped because it involved verifying text messages,
  # This step needed to call from SNF and then validate that care partner did not receive text notification.
  # Continued on Step 8.
  # Log in with the second user.
    - Type: case
      Value: CarePartnerLoginSecondaryUser
  # Click on the users dropdown.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_button$
  # Verify that the first user has gone off shift.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.offline_carepartner1_element$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform_header.offline_carepartner1_element$
      Greps:
        - var: CARE_PARTNER_ELEMENT
          match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: n_contain
        Var: CARE_PARTNER_ELEMENT
        Value: "Available"
    - Type: assert
      Asserts: 
      - Type: n_contain
        Var: CARE_PARTNER_ELEMENT
        Value: "Idle"
  # Log out of the second user too.
    - Type: case
      Value: CarePlatformLogout

#CXTB-234 Log Out - Manually of Portal and Stay On Shift
TestLogoutStayOnShift:
  Environment: Settings 
  Vars:
    LOGOUT_OPTION: "Stay On Shift"
    CARE_PARTNER_USER1_FULLNAME: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Calling Logout case.
    - Type: case
      Value: CarePlatformLogout
  # NOTE: Step 4 was skipped because it involved verifying text messages,
  # This step needed to call from SNF and then validate that care partner did receive text notification.
  # Continued on Step 5.
  # Log in with the second user.
    - Type: case
      Value: CarePartnerLoginSecondaryUser
  # Click on the users dropdown.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_button$
  # Verify that the first user has stayed on shift.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.onshift_carepartner1_element$
      

#CXTB-92: Verify Access and Review Team Member's Availability
TestAccessAndReviewTeamMembersAvailability:
  Environment: Settings
  Vars:
    CARE_PARTNER_USER1_FULLNAME: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Click on the users dropdown.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_button$
  # Care Partner list appears from right side of screen.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_list$
    - Type: sleep
      Time: 5
  # Verify that the list shows care partner users and current statuses.
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform_header.users_dropdown_list$
      Greps:
      - var: USERS_LIST_TEXT
        match: '[\s\S]*' # using single quotes due to YAML issues with regex and double quotes.
    - Type: assert
      Asserts: 
      - Type: contain
        Var: USERS_LIST_TEXT
        Value: "ON SHIFT"
    - Type: assert
      Asserts: 
      - Type: contain
        Var: USERS_LIST_TEXT
        Value: "OFF SHIFT"
    - Type: assert
      Role: desktopChrome
      Asserts:
      - Type: contain
        Var: USERS_LIST_TEXT
        Value: $AND_CLI_CARE_PARTNER_USER1_FULLNAME$
  # Click on the headset icon again.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_button$
  # Verify that the list disappears.
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_list$
      Attribute: className
      ResultVar: IS_LIST_OPEN
    - Type: assert
      Asserts:
        - Type: n_contain
          Var: IS_LIST_OPEN
          Value: users-dropdown-open

#CXTB-96: Answer Call from Queue & Complete a Medical Transfer
TestAnswerCallFromQueueAndCompleteMedicalTransfer:
  Environment: Settings
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Login as a senior.
    - Type: case
      Value: LoginNeverAloneHelper
  # Generate a medical call as a senior.
    - Type: case
      Value: CallCarePartner
  # Login and answer call as a care partner,
    - Type: case
      Value: AnswerCallAsCarePartner
  # Panel slides to the left, bringing you to the Call portal with the active call represented in the call video, and your user status has been automatically updated to "In session" (red dot). 
  # Both cameras default to off as they do currently.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.end_call_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Attribute: className
      ResultVar: IS_RED
    - Type: assert
      Asserts:
        - Type: contain
          Var: IS_RED
          Value: is-red
  # Verify video is disabled by default on the care partners.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
  # Verify video is disabled by default on the seniors.
    - Type: wait_not_visible
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
  # Click "Medical" button in video call window so the participant speaks to a doctor while on the call.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_transfer_btn$
  # "Telehealth request form" appears to the left of video call window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Click on "Submit" and verify that the form can't be submitted.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_error_label$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.reason_for_request_error_label$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_error_label$
  # Fill in the required fields:
  # Priority level, Reason for request and When did symptoms start?
  # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$
  # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.reason_for_request_covid_options$
  # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
  # Click on "Submit".
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
  # Telehealth request form window disappears.
    - Type: wait_not_visible
      Strategy: xpath
      Id : $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Verify "End Call" button has been replaced with "Leave Call" button.
    - Type: wait_for
      Strategy: xpath
      Id : $PAGE.care_platform_call_portal.leave_call_btn$
  # Log in as a provider and join the call
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: case
      Value: JoinMedicalTransfer
      Role: desktopChrome1
  # Care partner leaves the call after provider has joined.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
  # Verify that the video updates to show the "The call has ended" text.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CALL_MESSAGE
          Value: 'The call has ended.'
  # Fill up the post call survey to complete the session.
    - Type: case
      Value: PostCallSurveyCarePartner
  # Verify that care partner was returned to the "Call queue" page.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform.call_queue_title$
  # Verify that care partner is no longer showing as "In Session (red dot)".
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Attribute: className
      ResultVar: IS_RED
    - Type: assert
      Asserts:
        - Type: n_contain
          Var: IS_RED
          Value: is-red
  # Provider and senior tear down.
  # Provider ends call.
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.end_call_btn$
  # Provider fills up Post call Survey.
    - Type: case
      Value: PostCallSurveyProvider
      Role: desktopChrome1
  # Senior fills up Post call Survey.
    - Type: case
      Value: SeniorGreatPostSurveyCallHelper