#CXTB-228 Create Follow-Up Ticket for Participant
TestCreateFollowUpTicket:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_participant$
  #Select first participant in the list
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Go to follow-up tickets tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_tab_button$
  #Click on Create Ticket
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.create_ticket_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.create_ticket_button$
  #Fill Create Ticket's form
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_subject_input$
      Value: Automated test
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_kind_input$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.kind_medical_appointment_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_assigned_input$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.assigned_option_2$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_date_input$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.current_date_option$
  #Save form
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.save_ticket_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.save_ticket_button$
  #Wait for notification
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.new_ticket_notification$
  #Check new Follow-up ticket is among the others
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.new_ticket_subject$
    - Type: get_timestamp
      Format: "%m/%d/%Y"
      Var: TODAYS_DATE
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.new_ticket_date$

#CXTB-251 Access Participant Directory and Filter
TestParticipantDirectoryFilter:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
  #Get the value to compare later
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_darkened_letter_button$
      Greps:
        - var: LASTNAME_FILTER_LETTER
          match: "(.*)"
  #Click the first darkened letter button
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_darkened_letter_button$
  #Verify it was filtered by the selected letter
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_in_list_strong$
      Greps:
        - var: LASTNAME_FIRST_LETTER
          match: ^[a-zA-Z]   #The match selects: The first char from the starter word (^) that is a letter ([a-zA-Z])
    - Type: assert
      Asserts: 
      - Type: eq
        Var: LASTNAME_FIRST_LETTER
        Value: $AND_CLI_LASTNAME_FILTER_LETTER$
  #Remove the filter by letter
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.selected_darkened_letter_button$
  #Get the first lastname in the list
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_in_list_strong$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT_NO_FILTER
          match: (.*)
  #Add the search filter
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.search_button$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_participant.search_input$
      Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  #Verify there is at least 1 user with that name
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_in_list_strong$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_in_list_strong$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT
          match: (.*)
  #Verify the first participant lastname contains the text filtered
    - Type: assert
      Asserts: 
      - Type: contain
        Var: LASTNAME_FIRST_PARTICIPANT
        Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  #Clear the search by clicking small "x" at right of field
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.clear_search_button$
  #Verify there is at least 1 user
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_in_list_strong$
  #Click on an user
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Verify that a summary component is displayed
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$

#CXTB-106 Click and View Participantâ€™s Call History
TestParticipantCallHistory:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
  #Select first participant in the list
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Check Call History tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.call_history_tab_button$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.call_history_tab_button$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_row$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_row$
      Greps:
        - var: ROW_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: ROW_CLASS
          Value: 'is-open'
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_content$
      Greps:
        - var: DETAILS_CONTENT
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Duration'
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Participant'
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Partner'
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Notes'