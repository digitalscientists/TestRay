#CXTB-228 Create Follow-Up Ticket for Participant
TestCreateFollowUpTicket:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_participant$
  #Select first participant in the list
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Go to follow-up tickets tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_tab_button$
  #Click on Create Ticket
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.create_ticket_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.create_ticket_button$
  #Fill Create Ticket's form
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_subject_input$
      Value: Automated test
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_kind_input$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.kind_medical_appointment_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_assigned_input$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.assigned_option_2$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.ticket_date_input$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.current_date_option$
  #Save form
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.save_ticket_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.save_ticket_button$
  #Wait for notification
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.new_ticket_notification$
  #Check new Follow-up ticket is among the others
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.new_ticket_subject$
    - Type: get_timestamp
      Format: "%m/%d/%Y"
      Var: TODAYS_DATE
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.new_ticket_date$

#CXTB-251 Access Participant Directory and Filter
TestParticipantDirectoryFilter:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
  #Get the value to compare later
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_darkened_letter_button$
      Greps:
        - var: LASTNAME_FILTER_LETTER
          match: "(.*)"
  #Click the first darkened letter button
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_darkened_letter_button$
  #Verify it was filtered by the selected letter
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_LETTER
          match: ^[a-zA-Z]   #The match selects: The first char from the starter word (^) that is a letter ([a-zA-Z])
    - Type: assert
      Asserts: 
      - Type: eq
        Var: LASTNAME_FIRST_LETTER
        Value: $AND_CLI_LASTNAME_FILTER_LETTER$
  #Remove the filter by letter
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.selected_darkened_letter_button$
  #Get the first lastname in the list
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT_NO_FILTER
          match: (.*)
  #Add the search filter
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.search_button$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_participant.search_input$
      Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  #Verify there is at least 1 user with that name
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT
          match: (.*)
  #Verify the first participant lastname contains the text filtered
    - Type: assert
      Asserts: 
      - Type: contain
        Var: LASTNAME_FIRST_PARTICIPANT
        Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  #Clear the search by clicking small "x" at right of field
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.clear_search_button$
  #Verify there is at least 1 user
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
  #Click on an user
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Verify that a summary component is displayed
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$

#CXTB-106 Click and View Participantâ€™s Call History
TestParticipantCallHistory:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
  #Select first participant in the list
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Check Call History tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.call_history_tab_button$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.call_history_tab_button$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_row$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_row$
      Greps:
        - var: ROW_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: ROW_CLASS
          Value: 'is-open'
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.first_call_history_content$
      Greps:
        - var: DETAILS_CONTENT
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Duration'
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Participant'
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Partner'
    - Type: assert
      Asserts:
        - Type: contain
          Var: DETAILS_CONTENT
          Value: 'Notes'

#CXTB-105 Click and View Participant Record from Listing
TestParticipantRecordListing:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
  #Select first participant in the list
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Go to Records
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.records_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.participant_name$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.participant_dob$
  #Navigate between tabs
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.demographics_tab$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.demographics_tab$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
  #Go to Medical tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_tab$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_tab$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
  #Go to Medical Subtabs
  #Medications
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_medications_subtab$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_medications_subtab$
      Greps:
        - var: SUBTAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: SUBTAB_CLASS
          Value: 'active'
  #Medical needs
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_medical_needs_subtab$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_medical_needs_subtab$
      Greps:
        - var: SUBTAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: SUBTAB_CLASS
          Value: 'active'
  #Behavioral
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_behavioral_subtab$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_behavioral_subtab$
      Greps:
        - var: SUBTAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: SUBTAB_CLASS
          Value: 'active'
  #Medical History
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_medical_history_subtab$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.medical_medical_history_subtab$
      Greps:
        - var: SUBTAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: SUBTAB_CLASS
          Value: 'active'

#CXTB-93 Care Partner Platform - Review Participant Summary
TestCarePartnerParticipantReview:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  # Click on the Call Personal Care Partner
    - Type: wait_for
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_home.call_care_partner$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
  # Click "Non-Medical" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
  # Verify that screen redirects to the call waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
  # Back in CarePartners we should have a call in the queue
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform.call_queue_title$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_participant_row$
  # Check participant info in the right
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_details.participant_details_title$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_details.participant_dob$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_home.answer_call$
  #Check content on Health Overview Tab
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_details.health_overview_tab_nav$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_details.health_overview_tab_nav$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
    - Type: get_attribute
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.tab_nav_content$
      Greps:
        - var: HEALTH_TAB_CONTENT
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: HEALTH_TAB_CONTENT
          Value: 'At-A-Glance'
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: HEALTH_TAB_CONTENT
          Value: 'Common Issues'
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: HEALTH_TAB_CONTENT
          Value: 'Communication'
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: HEALTH_TAB_CONTENT
          Value: 'Warning Signs'
  # Check medication tab and content
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.medication_tab_nav$
    - Type: get_attribute
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.medication_tab_nav$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
  # Check Providers tab and content
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.providers_tab_nav$
    - Type: get_attribute
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.providers_tab_nav$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.health_insurance_button$
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.secondary_health_insurance_button$
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.tertiary_health_insurance_button$
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.primary_care_physician$
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.pharmacy_button$
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.preferred_lab_button$
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.specialist_button$
  #Check Call History tab
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.call_history_tab_button$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_details.call_history_tab_button$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
  #Go to follow-up tickets tab
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_details.follow_up_tab_button$
    - Type: get_attribute
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_tab_button$
      Greps:
        - var: TAB_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: TAB_CLASS
          Value: 'active'
  #These action beyond this point are not part of the test
  #but a way to avoid an unanswered call
    - Type: scroll_to
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_home.answer_call$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_home.answer_call$
      Role: desktopChrome
      # Click "End Call".
    - Type: click
      Strategy: xpath
      Condition:
      - Value: 20
        Operation: visible
        Result: true
      Id: $PAGE.care_platform_call_portal.end_call_button$
      Role: desktopChrome
    - Type: case
      Value: PostCallSurveyCarePartner
      Role: desktopChrome

# CXTB-95 - Answer Call from Queue & Complete the Session (without Medical Transfer)
TestCarePartnerAnswerAndComplete:
  Environment: Settings
  Precases:
    - SetNonTelehealthAppointmentForSenior
    - LoginNeverAloneHelper
    - CarePartnerCleanCallQueueAndHangedCalls
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  # Click on the Call Personal Care Partner
    - Type: wait_for
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_home.call_care_partner$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
  # Click "Non-Medical" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
  # Verify that screen redirects to the call waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
  # Back in CarePartners we should have a call in the queue
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform.call_queue_title$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_participant_row$
  # Answer Call
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_home.answer_call$
      Role: desktopChrome
  # Check elements
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
      Role: desktopChrome
  # Red indicator for 'In session'
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-red'
  # Video call controls are visible and function as expected when clicked
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_volume_button$
      Role: desktopChrome
    # Video should be disable from the get-go
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
    #Volume on and off
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_volume_button$
      Role: desktopChrome
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_volume_button$
      Role: desktopChrome
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
    #Goes back to ON
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_volume_button$
      Role: desktopChrome
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_volume_button$
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: n_contain
          Var: CLASS
          Value: 'off'
    # Video to on
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_camera_button$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: n_contain
          Var: CLASS
          Value: 'off'
    #There's no Hold feature for step 3
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_add_caller_button$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_medical_transfer_button$
    # Check Settings
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_settings_button$
    # Check Settings Modal
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_settings_modal.video_settings_modal_title$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_settings_modal.video_settings_modal_mic_select$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_settings_modal.video_settings_modal_speakers_select$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_settings_modal.video_settings_modal_camera_select$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_settings_modal.video_settings_modal_close_button$
    - Type: wait_not_visible
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_settings_modal.video_settings_modal_close_button$
  #Check contacts
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.first_contact_button$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.first_contact_button$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.first_contact_button$
      Greps:
        - var: CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'is-open'
  #Events and Calendar
    #Check Events
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.create_event_btn$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_create_event_modal.modal_title$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_create_event_modal.cancel_button$
    - Type: wait_not_visible
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_create_event_modal.modal_title$
    #Check Calendar
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.calendar_today_day$
      Greps:
        - var: TODAY_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: TODAY_CLASS
          Value: 'has-event' #An event for today was guarantee by the precase: SetNonTelehealthAppointmentForSenior
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.calendar_any_day_without_event$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.calendar_no_events_message$
  #End Call
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: CALL_MESSAGE
          Value: 'The call has ended'
  # Fill survey
    - Type: case
      Value: PostCallSurveyCarePartner
  # Green indicator for 'Available'
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-green'

#CXTB-96: Answer Call from Queue & Complete a Medical Transfer
TestCarePartnerAnswerCallFromQueueAndCompleteMedicalTransfer:
  Environment: Settings
  Precases:
    - CarePartnerCleanCallQueueAndHangedCalls
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Login as a senior.
    - Type: case
      Value: LoginNeverAloneHelper
  # Generate a medical call as a senior.
    - Type: case
      Value: CallCarePartner
  # Login and answer call as a care partner,
    - Type: case
      Value: AnswerCallAsCarePartner
  # Panel slides to the left, bringing you to the Call portal with the active call represented in the call video, and your user status has been automatically updated to "In session" (red dot).Â 
  #Â Both cameras default to off as they do currently.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.end_call_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Attribute: className
      ResultVar: IS_RED
    - Type: assert
      Asserts:
        - Type: contain
          Var: IS_RED
          Value: is-red
  # Verify video is disabled by default on the care partners.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
  # Verify video is disabled by default on the seniors.
    - Type: wait_not_visible
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
  # Click "Medical" button in video call window so the participant speaks to a doctor while on the call.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_transfer_btn$
  # "Telehealth request form" appears to the left of video call window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Click on "Submit" and verify that the form can't be submitted.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_error_label$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.reason_for_request_error_label$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_error_label$
  # Fill in the required fields:
  # Priority level, Reason for request and When did symptoms start?
  # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$
  # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.first_reason_for_request_available_option$
  # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
  # Click on "Submit".
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
  # Telehealth request form window disappears.
    - Type: wait_not_visible
      Strategy: xpath
      Id : $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Verify "End Call" button has been replaced with "Leave Call" button.
    - Type: wait_for
      Strategy: xpath
      Id : $PAGE.care_platform_call_portal.leave_call_btn$
  # Log in as a provider and join the call
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: case
      Value: JoinMedicalTransfer
      Role: desktopChrome1
  # Care partner leaves the call after provider has joined.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
  # Verify that the video updates to show the "The call has ended" text.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CALL_MESSAGE
          Value: 'The call has ended.'
  # Fill up the post call survey to complete the session.
    - Type: case
      Value: PostCallSurveyCarePartner
  # Verify that care partner was returned to the "Call queue" page.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform.call_queue_title$
  # Verify that care partner is no longer showing as "In Session (red dot)".
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Attribute: className
      ResultVar: IS_RED
    - Type: assert
      Asserts:
        - Type: n_contain
          Var: IS_RED
          Value: is-red
  # Provider and senior tear down.
  # Provider ends call.
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
  # Provider fills up Post call Survey.
    - Type: case
      Value: PostCallSurveyProvider
      Role: desktopChrome1
  # Senior fills up Post call Survey.
    - Type: case
      Value: SeniorGreatPostSurveyCallHelper

# CXTB-97 Review Behavior When on Active Call and Navigate Portal While on Call
TestCarePartnerBrowsingWhileOnCall:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
    - CarePartnerCleanCallQueueAndHangedCalls
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  # Click on the Call Personal Care Partner
    - Type: wait_for
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_home.call_care_partner$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
  # Click "Non-Medical" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
  # Verify that screen redirects to the call waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
  # Back in CarePartners we should have a call in the queue
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform.call_queue_title$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_participant_row$
  # Answer Call
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_home.answer_call$
      Role: desktopChrome
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
      Role: desktopChrome
  # Go into the records
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.call_participant_records$
    #Checking fixed video 
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
    # Red indicator for 'In session'
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-red'
  # Click around
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_records.medical_tab$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_records.medical_tab$
      Greps:
        - var: ACTIVE_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: ACTIVE_CLASS
          Value: 'active' 
    #Checking fixed video 
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_records.call_history_tab$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_records.emergency_calls_tab$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_records.follow_up_tickets_tab$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_participant_records.call_history_title$
    #Checking fixed video 
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
  # Check on Hide button
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_hide_button$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
      Greps:
        - var: VIDEO_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: VIDEO_CLASS
          Value: 'app-video-hidden'
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_show_button$
  # Show video again
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_show_button$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
      Greps:
        - var: VIDEO_CLASS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: n_contain
          Var: VIDEO_CLASS
          Value: 'app-video-hidden'
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_hide_button$
  # Hover over the video tile
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
    - Type: hover
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_return_span$
      Condition:
      - Value: 2
        Operation: visible
        Result: true
    - Type: wait_not_visible
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_floating_video_call.video_fixed_content$
      Time: 5
  #End Call
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: CALL_MESSAGE
          Value: 'The call has ended'
  # Fill survey
    - Type: case
      Value: PostCallSurveyCarePartner

# CXTB-124: Call Participant's device - Call Complete.
TestCarePartnerCallParticipantsDeviceCallComplete:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
    - SeniorCleanPrompts
    - CarePartnerCleanCallQueueAndHangedCalls
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop 
    - Role: localiOS
      App: NeverAlone
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Navigate to Participants.
    - Type: case
      Value: CarePartnerNavigateToParticipants
  # Click on the corresponding participant.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_complete_name$
  # Click on the "Call Portal" button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
  # Page updates to show portal screen with "No active call" text in video window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_MESSAGE
          Value: 'No active call.'
  # Click "Call Participant" button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_participant_btn$
  # Video window updates visually as call attempt is made.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.unanswered_call_icon$
  # Answer call on the Participant Device.
    - Type: case
      Value: AnswerCallAsSenior
  # Page updates to become an active call screen with video call in portal and normal functions 
  # and Notes section as seen when an inbound call has been answered.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_volume_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
  # End the call.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.end_call_button$
  # Video feed ends, area updating to show a message that the call has ended.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_MESSAGE
          Value: 'The call has ended.'
  # Verify that your status will remain "In session" until you have completed and submitted the post call survey to fully complete the session.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Attribute: className
      ResultVar: IS_RED
    - Type: assert
      Asserts:
        - Type: contain
          Var: IS_RED
          Value: is-red
  # Fill up the post call survey.
    - Type: case
      Value: PostCallSurveyCarePartner
  # Fill up Senior post call survey.
    - Type: case
      Value: SeniorGreatPostSurveyCallHelper
  # Verify you are returned to the Call queue page and your user status is no longer showing as "In session" (red dot).
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-green'

# CXTB-126: Call Participant's device - Call Ignored.
TestCarePartnerCallParticipantsDeviceCallIgnored:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
    - CarePartnerCleanCallQueueAndHangedCalls
    - SeniorCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop 
    - Role: localiOS
      App: NeverAlone
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Navigate to Participants.
    - Type: case
      Value: CarePartnerNavigateToParticipants
  # Click on the corresponding participant.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_complete_name$
  # Click on the "Call Portal" button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
  # Page updates to show portal screen with "No active call" text in video window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_MESSAGE
          Value: 'No active call.'
  # Click "Call Participant" button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_participant_btn$
  # Video window updates visually as call attempt is made.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.unanswered_call_icon$
  # Participant must select the "Ignore Call" button.
    - Type: case
      Value: IgnoreCallAsSenior
  # Click "No message" to end the process without sending the participant a message.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.no_message_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.no_message_button$
      Condition:
      - Value: 5
        Operation: visible
        Result: true
  # Call portal returns to no active call display.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_MESSAGE
          Value: 'No active call.'

# CXTB-128: Call Participant's device - Call Missed.
TestCarePartnerCallParticipantsDeviceCallMissed:
  Vars:
    MESSAGE_TO_PARTICIPANT: Automation Message CXTB-128
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
    - CarePartnerCleanCallQueueAndHangedCalls
    - SeniorCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop 
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 100
      App: NeverAlone
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Navigate to Participants.
    - Type: case
      Value: CarePartnerNavigateToParticipants
  # Click on the corresponding participant.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_complete_name$
  # Click on the "Call Portal" button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
  # Page updates to show portal screen with "No active call" text in video window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_MESSAGE
          Value: 'No active call.'
  # Click "Call Participant" button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_participant_btn$
  # Video window updates visually as call attempt is made.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.unanswered_call_icon$
  # Wait for 1 minute so the call can be missed, do not answer the call
    - Type: sleep
      Time: 60
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.incoming_call_header$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.incoming_call_header$
  # End the call on the Care Partner side.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.end_call_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.end_call_button$
  # Verify that the window updates to indicate the participant is not available.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.participant_not_available_text$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.participant_not_available_text$
      Greps:
        - var: PARTICIPANT_NOT_AVAILABLE_TEXT
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: PARTICIPANT_NOT_AVAILABLE_TEXT
          Value: $AND_CLI_carepartner_user1_name$ is not available.Would you like to leave a text message?
  # Verify that there is an option for the care partner to leave a text message.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_message_participant_input$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.yes_message_button$
  # Verify that the Participant received a "Missed Call" prompt indicating who called and when.
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_missed_call.missed_call_header$
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_missed_call.from_label$
    - Type: return_element_attribute
      Role: localiOS
      Strategy: xpath
      Id: $PAGE.seniors_app_missed_call.from_value$
      Attribute: value
      ResultVar: MSG_FROM_VALUE
    - Type: assert
      Asserts:
        - Type: contain
          Var: MSG_FROM_VALUE
          Value: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_missed_call.when_label$
  # Close the prompt on the Never Alone Seniors app.
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_missed_call.close_btn$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_missed_call.close_btn$
    - Type: wait_not_visible
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_missed_call.close_btn$
      Time: 10
  # Care Partner sends a message in the available box and click on the "Yes, send message" button.
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_message_participant_input$
      Value: $AND_CLI_MESSAGE_TO_PARTICIPANT$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.yes_message_button$
  # Call portal returns to no active call display.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_MESSAGE
          Value: 'No active call.'
  # Verify that the Participant receives a "Personal Care Partner Message" prompt showing the message, who sent it and when.
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.message_header$
    - Type: return_element_attribute
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.message_header$
      Attribute: label
      ResultVar: MESSAGE_HEADER_TITLE
    - Type: assert
      Asserts:
        - Type: eq
          Var: MESSAGE_HEADER_TITLE
          Value: Personal Care Partner Message
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.from_label$
    - Type: return_element_attribute
      Role: localiOS
      Strategy: xpath
      Id: $PAGE.seniors_app_message_modal.from_value$
      Attribute: label
      ResultVar: FROM_VALUE
    - Type: assert
      Asserts:
        - Type: eq
          Var: FROM_VALUE
          Value: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.sent_label$
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_message_modal.message_label$
    - Type: return_element_attribute
      Role: localiOS
      Strategy: xpath
      Id: $PAGE.seniors_app_message_modal.message_value$
      Attribute: label
      ResultVar: MESSAGE_VALUE
    - Type: assert
      Asserts:
        - Type: eq
          Var: MESSAGE_VALUE
          Value: $AND_CLI_MESSAGE_TO_PARTICIPANT$

# CXTB-148: Participant Component - Track Time and Edit Follow-up Tickets for Participant
TestCarePartnerTrackTimeAndEditFollowUpTicketsParticipantComponent:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
    - CarePartnerCleanCallQueueAndHangedCalls
    - SeniorCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop 
    - Role: localiOS
      App: NeverAlone
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Generate unique name for the follow up ticket.
    - Type: generate_unique_name
      Name: "FollowUp Ticket"
      ResultVar: FOLLOW_UP_TICKET
  # Generate a Follow Up Ticket.
    - Type: case
      Value: CarePartnerCreateFollowUpTicket
  # Navigate to Participants.
    - Type: case
      Value: CarePartnerNavigateToParticipants
  # Click on the corresponding participant.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_complete_name$
  # Click on the "Call Portal" button.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
  # Click on the "Follow-up Tickets" tab on the left bottom of the page.
    #  Todo: remove this sleep.
    - Type: sleep
      Time: 5
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_tab_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_tab_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.call_history_list$
  # User should see a list of Follow-up Tickets.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_tickets_list$
  # Click on a follow-up ticket in the listing.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_ticket_based_on_name$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.follow_up_ticket_based_on_name$
  # Participant component appears on the right side of the screen, with the related follow-up ticket expanded for review.
  