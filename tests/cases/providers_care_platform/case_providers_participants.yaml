#CXTB-170: Participant Page Navigation
#CXTB-171: Access Participant Directory & Filter
#CXTB-172: Click and View Facility Device Record from Listing
TestAccessParticipantDirectoryandViewDeviceRecordfromListing:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Log in Care Platform as an Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
  # Go to Participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.participants_navigation$      
  # Get the value to compare.
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_participants_page.first_darkened_letter_button$
      Greps:
        - var: LASTNAME_FILTER_LETTER
          match: "(.*)"
  # Click the first darkened letter button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.first_darkened_letter_button$
  # Verify it was filtered by the selected letter.
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_participants_page.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_LETTER
          match: ^[a-zA-Z]  
    - Type: assert
      Asserts: 
      - Type: eq
        Var: LASTNAME_FIRST_LETTER
        Value: $AND_CLI_LASTNAME_FILTER_LETTER$
  # Remove the filter by clicking on the letter.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.selected_darkened_letter_button$
  # Get the first lastname in the list.
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_participants_page.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT_NO_FILTER
          match: (.*)
  # Add the search filter.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.search_button$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_participants_page.search_input$
      Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  # Verify there is at least one participant with that name.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_participants_page.first_senior_lastname$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_participants_page.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT
          match: (.*)
  # Verify the first participant lastname contains the text filtered.
    - Type: assert
      Asserts: 
      - Type: contain
        Var: LASTNAME_FIRST_PARTICIPANT
        Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  # Clear the search by clicking small "x" on right of the field.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.clear_search_button$
  # Verify there is at least one participant.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_participants_page.first_senior_lastname$
  # Click on a participant.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.senior_1_row$
  # Verify that the info is showing after selecting the participant.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_participants_page.senior_1_row$
  # filter by status
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.status_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_participants_page.status_dropdown_options$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.status_dropdown_options$
  # Verify that the info is showing after selecting the filter.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_participants_page.senior_1_row$
  # filter back to all
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.status_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_participants_page.status_dropdown_options$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.status_dropdown_options$      
  # Click facilities button
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.facilities_navigation$
  # click on the first listing record
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.first_senior_lastname$
  # click on Devices button and verify if tab showeing belogs to Devices
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.devices_tab$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.title_subtab_devices$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.tabs_content$
      Greps:
      - var: TAB_CLASS
        attr: tab-title
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts:
      - Type: contain
        Var: TAB_CLASS
        Value: 'Devices'
  # Click on record button and check the Overview Tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.records_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.info_title$
  # Click on Devices button to see the facility device list
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.devices_button$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.device_status$
      Greps:
      - var: STATUS_CLASS
        attr: class
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts:
      - Type: contain
        Var: STATUS_CLASS 
        Value: 'active'