SetFollowUpTicket:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: desktop
    - Role: localiOS
      App: NeverAlone
  Actions:
      # Navigate to Facilities
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.facilities_navigation$
      # Select the Alpha center
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.alpha_center_td$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.call_portal_btn$
    - Type: case
      Role: localiOS
      Value: LoginSNFHelper
      # Call an SNF Facility
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.call_device_btn$      
      # Answer the call from SNF
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
      # Fill the notes
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.subject_input$
      Value: Follow-up Subject Automation
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.details_textarea$
      Value: Follow-up Details Automation 
      # Close the call 
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.end_call_btn$
      # Complete the call in SNF
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.to_home_button$
      # Complete the session 
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.complete_session_btn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.complete_session_btn$
      # Set and Fill the follow up ticket
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.no_radiobtn$   
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.reason_last_option$     
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.time_follow_up_two_days_radiobtn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.submit_session_btn$

SetScheduledCallTicket:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: desktop       
  Actions:   
      # Navigate to Participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
      # Open the Call Portal
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_td$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.create_event_btn$    
      # Create the event
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.create_event_btn$    
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.category_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.teleheath_appointment_option$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.subject_input$
      Value: Automation test subject
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.date_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_call_portal.start_time_picker$
      Value: 800a
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_call_portal.end_time_picker$
      Value: 900p
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.next_btn$
      # Filling the Situation fields
      # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$
      # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.first_reason_for_request_available_option$
      # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
      # Click in the submit button
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_create_event_btn$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_notifications.event_created_notification$
      # Navigate back to home 
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_home$

SetMissedCallTicket:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: desktop   
    - Role: localiOS
      App: NeverAlone
  Actions:   
      # Navigate to Participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
      # Open the Call Portal
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_td$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
      # Login to Seniors Never Alone App
    - Type: case
      Role: localiOS
      Value: LoginNeverAloneHelper
      # Call the participant
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_participant_btn$
      # Answer the call
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
      # Open the Meical Transfer
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_transfer_btn$
      # Fill the medical transfer fields
      # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$
      # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.first_reason_for_request_available_option$
      # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
      # Click in the submit button
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
      # Workaround: to make it appear Missed, it has to be waiting for 60 seconds. If appium passes 30+ seconds in sleep, it fails.
    - Type: sleep
      Role: localiOS
      Time: 20
    - Type: click
      Role: localiOS
      Strategy: xpath
      Id: $PAGE.seniors_app_call.mute_call_button$
    - Type: sleep
      Role: localiOS
      Time: 20
    - Type: click
      Role: localiOS
      Strategy: xpath
      Id: $PAGE.seniors_app_call.mute_call_button$
    - Type: sleep
      Role: localiOS
      Time: 20
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
      # Complete the call in Seniors App
    - Type: click
      Role: localiOS
      Strategy: xpath
      Id: $PAGE.seniors_app_call.end_call_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.to_home_button$
      # Fill the notes
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.subject_input$
      Value: Missed Call Subject Automation
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_queue_page.details_textarea$
      Value: Missed Call Details Automation     
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$ 
      Property: disabled
      Value: "false"
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$             
      # Fill the Post-call Survey
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$             
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.issue_resolved_yes_radiobutton$          
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.category_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_question_option$
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.subcategory_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.located_provider_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_and_exit_session_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_notifications.call_completed_notification$

      # CXTB-217
TestHomePageListingView:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Stay On Shift"   
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: desktop
    - Role: localiOS
      App: NeverAlone
  Actions:
      # Login to the Care Platform app with Care Partners account
    - Type: case
      Value: CarePartnerLogin
      # Setup for the test data
      # Missed call 
    - Type: case
      Value: SetMissedCallTicket
    - Type: case
      Value: TerminateApp
      # Logout from the Care Partner account
    - Type: case
      Value: CarePlatformLogout
      # Login to the app with Providers account
    - Type: case
      Value: ProvidersCarePlatformLogin
      # Follow-up ticket
    - Type: case
      Value: LaunchApp
    - Type: case
      Value: SetFollowUpTicket
      # Logout from the Care Partner account
    - Type: case
      Value: CarePlatformLogout
      # Terminate the iOS App
    - Type: case
      Value: TerminateApp
      # Login to the Care Platform app with Care Partners account
    - Type: case
      Value: CarePartnerLogin
      # Scheduled call
    - Type: case
      Value: SetScheduledCallTicket
      # Logout from the Care Partner account
    - Type: case
      Value: CarePlatformLogout
      # Login to the app with Providers account
    - Type: case
      Value: ProvidersCarePlatformLogin
      # Set the Time to All
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
    - Type: click
      Strategy: xpath
      Condition:
        - Value: 5
          Operation: visible
          Result: true
      Id: $PAGE.providers_home_page.time_all_option$
    - # Check that there are no active calls waiting to be answered
      Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$  
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_on_demand_row$  
      # Verify Missed calls are present
    - Type: get_text  
      Strategy: xpath
      Id: $PAGE.providers_home_page.missed_calls_text$
      Greps:
      - var: missed_call_text
        match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: eq 
        Var: missed_call_text
        Value: "Missed Call"
        raise: true
      # Verify Scheduled calls are present
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_home_page.scheduled_calls$
      Greps:
      - var: scheduled_call_text
        match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: eq 
        Var: scheduled_call_text
        Value: "Scheduled Call"
        raise: true
      # Verify Follow-up calls are present
    - Type: get_text  
      Strategy: xpath
      Id: $PAGE.providers_home_page.follow_up_calls$
      Greps:
      - var: follow_up_text
        match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: eq 
        Var: follow_up_text
        Value: "Follow-up"
        raise: true

# CXTB-231 Status Drop-down Options - Not on Active Call
TestStatusNotOnActiveCallForProviders:
  Environment: Settings  
  Roles:
    - Role: desktopChrome
      App: desktop
  Actions:
      # Login to the Care Platform app with Providers account
    - Type: case
      Value: ProvidersCarePlatformLogin
      # Status
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
      # Changing status to away
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_away_button$
      # Navigate to Facilities
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.facilities_navigation$
      # Checking indicator is set to Away status
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-empty"
      # Trying to change status to In Session (shouldn't let you do it manually)
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
    - Type: click_js
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
      # Navigate to Employees
    - Type: click
      Strategy: xpath
      Id : $PAGE.providers_home_page.employees_navigation$
      # Verifying the status indicator didn't change to In Session
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-empty"
      # Changing status back to available
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
    - Type: click
      Strategy: xpath
      Id : $PAGE.providers_home_page.employees_navigation$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Employees*"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Employees"
      # Checking the status indicator correspond to Available
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-green"