# CXTB-118 Providers Care Platform - Homepage Listing View
TestProviderHomePageListingView:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Go Off Shift"  
  Precases:
    - ProviderNewCleaner
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 120
      App: NeverAlone
  Actions:
      # Setup for the test data
      #Call login for nurses
    - Type: case
      Role: localiOS
      Value: LoginSNFHelper
      #Calling Prompt cleaner
    - Type: case
      Role: localiOS
      Value: SeniorCleanPrompts
      #Missed call 
    - Type: case
      Value: SetMissedCallFromSNF
      #Clean any prompt notification from the start
    - Type: case
      Role: localiOS
      Value: SeniorCleanPrompts
      #Login as Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
      #Follow-up ticket
    - Type: case
      Value: CreateAFollowUpForSNFCall
      #Making sure that the provider is logged out
    - Type: case
      Value: CarePlatformLogout
      #Scheduled call from Employee
      #Opening new tab for the employee's part of the process
    - Type: new_tab
    - Type: switch_window
      Value: 1
    - Type: case
      Value: SetScheduledCallTicketFromEmployee
      #Switch back to providers tab
    - Type: switch_window
      Value: 0
      #Login again
    - Type: case
      Value: ProvidersCarePlatformLogin
      #Checking there's no call or session open right now
    - Type: case
      Value: ProviderEndCurrentCall
      #Navigating to Home
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_home$
      #Set Time to All
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Condition:
        - Value: 5
          Operation: visible
          Result: true
      #Check the different calls on the queue
      # Verify Missed calls are present
    - Type: get_text  
      Strategy: xpath
      Id: $PAGE.providers_home_page.missed_call$
      Greps:
      - var: missed_call_text
        match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: contain
        Var: missed_call_text
        Value: "Missed Call"
        raise: true
      # Verify Scheduled calls are present
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_home_page.scheduled_call$
      Greps:
      - var: scheduled_call_text
        match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: contain
        Var: scheduled_call_text
        Value: "Scheduled Call"
        raise: true
      # Verify Follow-up calls are present
    - Type: get_text  
      Strategy: xpath
      Id: $PAGE.providers_home_page.follow_up_calls$
      Greps:
      - var: follow_up_text
        match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: contain
        Var: follow_up_text
        Value: "Follow-up"
        raise: true

# CXTB-104 Provider's Status - Not on Active Call
TestProviderStatusNotOnActiveCall:
  Environment: Settings
  Precases:
    - ProviderNewCleaner
  Roles:
    - Role: desktopChrome
      App: desktop
  Actions:
      # Login to the Care Platform app with Providers account
    - Type: case
      Value: ProvidersCarePlatformLogin
      # Status should be available after login
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-green"
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_user_dropdown_menu.user_status_available$
      #Shift status "ON SHIFT"
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_user_dropdown_menu.user_shift_toggle_label$
      Greps:
        - var: SHIFT_VAR
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: SHIFT_VAR
          Value: "On"
      #Change shift status to off
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_user_dropdown_menu.user_shift_toggle_checkbox$
    - Type: sleep
      Time: 2
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_user_dropdown_menu.user_shift_toggle_label$
      Greps:
        - var: SHIFT_VAR
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: SHIFT_VAR
          Value: "Off"
      #Change back to available
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_user_dropdown_menu.user_shift_toggle_checkbox$
    - Type: sleep
      Time: 2
      #Log out and stay on shift, to check if the status is Idle
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_button$
      # Calling Logout case.
    - Type: set_env_var
      Value: "Stay On Shift"
      Var: LOGOUT_OPTION
    - Type: case
      Value: CarePlatformLogout
      # Log in with the second user.
    - Type: case
      Value: ProviderLoginSecondaryUser
    # Click on the users dropdown.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.headset_dropdown_button$
    # Verify that the first user has stayed on shift, and Idle
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_user_dropdown_menu.user_list_item_provider1$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_user_dropdown_menu.user_list_item_provider1$
      Greps:
        - var: STATUS_PROVIDER1
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_PROVIDER1
          Value: "Idle"

# Physical Device only.
# CXTB-133: Verify that Providers answer SNF call and completes session.
TestProvidersAnswerSNFCallAndCompletesSession:
  Environment: Settings
  Vars:
    PROVIDERS_SUBJECT:  Automation Test Call SNF.
    PROVIDERS_DETAILS:  Automation Test Notes Verify that Providers answer SNF call and completes session.
  Precases:
    - ProviderNewCleaner
    - LoginSNFHelper
  Aftercases:
    - TerminateApp
    - ProviderEndCurrentCall
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
  Actions:
    # Login to the Care Platform app with Providers account.
    - Type: case
      Value: ProvidersCarePlatformLogin
    #Calling Prompt cleaner
    - Type: case
      Role: localiOS
      Value: SeniorCleanPrompts
    # Call Provider from SNF.
    - Type: case
      Value: SNFNewRequestHelper
    # Click on the corresponding call on the Home page to and click on the "Answer" button.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_based_on_participant_name$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_based_on_participant_name$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    # Call portal should be displayed and the user status has been automatically updated to "In session" (red dot).
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-red'
    # Verify video is disabled by default on the Providers.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
  # Verify video is disabled by default on the SNF.
    - Type: wait_not_visible
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
    # Click the "End Call" button.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    # Video area updates to show a message showing that the call has ended.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CALL_MESSAGE
          Value: 'The call has ended'
    # Verify that the status still is "In Session".
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-red'
    # Fill the Provider's call notes
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Value: $AND_CLI_PROVIDERS_SUBJECT$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
      Value: $AND_CLI_PROVIDERS_DETAILS$
    # Click the "Complete session" button.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
      Property: disabled
      Value: "false"
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
    # Post-call survey screen appears with your current notes pre-populated.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.post_call_survey_title$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Attribute: value
      ResultVar: SUBJECT_SUBJECT_CURRENT_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: SUBJECT_SUBJECT_CURRENT_TEXT
          Value: $AND_CLI_PROVIDERS_SUBJECT$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
      Attribute: value
      ResultVar: SUBJECT_NOTES_CURRENT_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: SUBJECT_NOTES_CURRENT_TEXT
          Value: $AND_CLI_PROVIDERS_DETAILS$
    # Change to "No" on the "Was issue resolved" question.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_no_option$
    # Survey updates based on this response:
    # New "Reason" field appears.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_label$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_input$
    # "Follow-up recommended" is automatically selected.
    - Type: wait_for_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.follow_up_recommended_checkbox$
      Attribute: value
      Value: true
    # New time options appear below Follow-up recommended checkbox, with "1 hour" selected.
    - Type: wait_for_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.selected_follow_up_time_option$
      Attribute: value
      Value: "1"
    # "Assign to myself" box appears and is automatically selected.
    - Type: wait_for_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_myself_checkbox$
      Attribute: value
      Value: true
    # Select a reason and click on the "Submit and Exit Session" button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_input$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.first_reason_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_no_option$
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    # User is redirected to the Home Listing page with the new Follow-up ticket included in the listing.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$
    # Set Time to all so the follow-up appears.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Condition:
        - Value: 5
          Operation: visible
          Result: true
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.follow_up_ticket_based_on_participant_name$
    # Close ticket so it cleans the Home queue.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.follow_up_ticket_based_on_participant_name$
    - Type: sleep
      Time: 5
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
      Value: 'Automation Test Close Ticket'
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.save_and_close_ticket_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_notifications.follow_up_ticket_closed_notification$

#CTB-205 User Manual Available through "help" Menu Option  
TestProviderHelpMenuOption:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Log in with my provider User 
    - Type: case
      Value: ProvidersCarePlatformLogin
  # Click your name in upper Right corner after click on help option
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.dropdown_username$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.button_help$
  #Verify the Help page is visible
    - Type: switch_window
      Value: 1
      CheckTime: 10
    - Type: get_url
      Greps:
      - var: HELP_PAGE_URL
        match: provider_user_manual(.*).pdf
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: HELP_PAGE_URL
          Value: provider_user_manual
        - Type: contain
          Var: HELP_PAGE_URL
          Value: .pdf

# CXTB-125: Providers - Seniors - Return to Call Portal & Complete the Session
TestProvidersReturnToCallPortalAndAndCompletesSession:
  Environment: Settings
  Vars:
    PROVIDERS_SUBJECT:  Automation Test Call Senior.
    PROVIDERS_DETAILS:  Automation Test Notes Verify that Providers answer Senior call and completes session.
  Precases:
    - LoginNeverAloneHelper
    - CarePartnerCleanCallQueueAndHangedCalls
    - SeniorCleanPrompts
    - ProviderNewCleaner
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
    # Generate a medical call as a senior.
    - Type: case
      Value: CallCarePartner
  # Login and answer call as a care partner,
    - Type: case
      Value: AnswerCallAsCarePartner
  # Panel slides to the left, bringing you to the Call portal with the active call represented in the call video, and your user status has been automatically updated to "In session" (red dot). 
  # Both cameras default to off as they do currently.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.end_call_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Attribute: className
      ResultVar: IS_RED
    - Type: assert
      Asserts:
        - Type: contain
          Var: IS_RED
          Value: is-red
  # Verify video is disabled by default on the care partners.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
  # Verify video is disabled by default on the seniors.
    - Type: wait_not_visible
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
  # Click "Medical" button in video call window so the participant speaks to a doctor while on the call.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_transfer_btn$
  # "Telehealth request form" appears to the left of video call window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Click on "Submit" and verify that the form can't be submitted.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_error_label$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.reason_for_request_error_label$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_error_label$
  # Fill in the required fields:
  # Priority level, Reason for request and When did symptoms start?
  # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$  
  # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.first_reason_for_request_available_option$
  # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
  # Click on "Submit".
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
  # Telehealth request form window disappears.
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Verify "End Call" button has been replaced with "Leave Call" button.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
  # Log in as a provider and join the call
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: case
      Value: JoinMedicalTransfer
      Role: desktopChrome1
  # Care partner leaves the call after provider has joined.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
  # Verify that the video updates to show the "The call has ended" text.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CALL_MESSAGE
          Value: 'The call has ended.'
  # Fill up the post call survey to complete the session.
    - Type: case
      Value: PostCallSurveyCarePartner
  # Verify that care partner was returned to the "Call queue" page.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform.call_queue_title$
  # Verify that care partner is no longer showing as "In Session (red dot)".
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Attribute: className
      ResultVar: IS_RED
    - Type: assert
      Asserts:
        - Type: n_contain
          Var: IS_RED
          Value: is-red
  # Provider and senior tear down.
  # Provider ends call.
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
  # Provider fills up Post call Survey.
  # Fill the Provider's call notes
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
    - Type: send_keys
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Value: $AND_CLI_PROVIDERS_SUBJECT$
    - Type: send_keys
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
      Value: $AND_CLI_PROVIDERS_DETAILS$
    # Click the "Complete session" button.
    - Type: wait_for_property
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
      Property: disabled
      Value: "false"
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
    # Post-call survey screen appears with your current notes pre-populated.
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.post_call_survey_title$
    - Type: return_element_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Attribute: value
      ResultVar: SUBJECT_SUBJECT_CURRENT_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: SUBJECT_SUBJECT_CURRENT_TEXT
          Value: $AND_CLI_PROVIDERS_SUBJECT$
    - Type: return_element_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
      Attribute: value
      ResultVar: SUBJECT_NOTES_CURRENT_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: SUBJECT_NOTES_CURRENT_TEXT
          Value: $AND_CLI_PROVIDERS_DETAILS$
    # Change to "No" on the "Was issue resolved" question.
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_no_option$
     # Was this Video Visit with a patient?
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_call_handling_page.video_visit_true_option$          
    - Type: click
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_call_handling_page.video_visit_true_option$  
    # Survey updates based on this response:
    # New "Reason" field appears.
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_label$
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_input$
    # "Follow-up recommended" is automatically selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.follow_up_recommended_checkbox$
      Attribute: value
      Value: true
    # New time options appear below Follow-up recommended checkbox, with "1 hour" selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.selected_follow_up_time_option$
      Attribute: value
      Value: "1"
    # "Assign to myself" box appears and is automatically selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_myself_checkbox$
      Attribute: value
      Value: true
    # Select a reason and click on the "Submit and Exit Session" button.
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_input$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.first_reason_option$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_no_option$
    - Type: scroll_to
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    # User is redirected to the Home Listing page with the new Follow-up ticket included in the listing.
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$
    # Set Time to all so the follow-up appears.
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Condition:
        - Value: 5
          Operation: visible
          Result: true
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.follow_up_ticket_based_on_participant_name$
    # Close ticket so it cleans the Home queue.
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.follow_up_ticket_based_on_participant_name$
    - Type: sleep
      Time: 5
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
    - Type: click
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
    - Type: click
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
    - Type: send_keys
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
      Value: 'Automation Test Close Ticket'
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.save_and_close_ticket_button$
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_notifications.follow_up_ticket_closed_notification$
  # Senior fills up Post call Survey.
    - Type: case
      Value: SeniorGreatPostSurveyCallHelper

# CXTB-147 Return Missed SNF Call from Home (Answered)
TestProviderReturnMissedSNFCall:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Go Off Shift"
  Aftercases:
    - TerminateApp
    - CarePlatformLogout
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 120
      App: NeverAlone
  Actions:
    # Setup for the test data
      #Call login for nurses
    - Type: case
      Role: localiOS
      Value: LoginSNFHelper
      #Calling Prompt cleaner
    - Type: case
      Role: localiOS
      Value: SeniorCleanPrompts
      #Login as Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
      #Clean-up of current calls
    - Type: case
      Value: ProviderEndCurrentCall
      #Missed call 
    - Type: case
      Value: SetMissedCallFromSNF
    # Select Missed call from Home
    - Type: refresh
      Role: desktopChrome
    - Type: wait_for  
      Strategy: xpath
      Id: $PAGE.providers_home_page.missed_call$
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_home_page.missed_call$
    # Check it contains the correct data
    # Assign to "Me"
    - Type: wait_for  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_update_dropdown_button$
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_update_dropdown_button$
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
    - Type: sleep
      Time: 0.8
    # Check Assigment
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.selected_missed_call$
      Greps:
      - var: SELECTED_MISSED_CALL
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts: 
        - Type: contain
          Var: SELECTED_MISSED_CALL
          Value: 'Me'
    - Type: assert
      Asserts:
        - Type: contain
          Var: SELECTED_MISSED_CALL
          Value: 'Nursing (PHP)'
    # Unassign call
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_update_dropdown_button$
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.unnasign_button$
    # Call Device
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_device_btn$
    # Incoming call on SNF
    - Type: case
      Value: SNFAnswerIncomingCall
    # Check Provider's In Session dot
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-red'
    # Complete Call, Session and Survey
      #Provider ends call.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      #Provider fills up Post call Survey.
    - Type: case
      Value: PostCallSurveyProvider
    # Check you are redirected to Home
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$
      #Set Time to all so the follow-up appears.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Condition:
        - Value: 5
          Operation: visible
          Result: true
    # Green indicator dot for Available
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-green'
    # Clean used missed call
    - Type: refresh
      Role: desktopChrome
    - Type: case
      Value: CleanUsedMissedCall

# CXTB-610: Providers - SNF - Select Call in Queue and Get Call Answered Notification.
TestProvidersSelectCallInQueueAndGetCallAnsweredAlreadyNotification:
  Environment: Settings
  Precases:
    - ProviderNewCleaner
    - LoginSNFHelper
  Aftercases:
    - TerminateApp
    - ProviderEndCurrentCall
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: desktopChrome1
      App: desktop
    - Role: localiOS
      App: NeverAlone
  Actions:
    # Login to the Care Platform app with Providers account.
    - Type: case
      Value: ProvidersCarePlatformLogin
    # Calling Prompt cleaner
    - Type: case
      Value: SeniorCleanPrompts
    # Starting scenario where SNF ends call before Provider answers it. 
    # Call Provider from SNF.
    - Type: case
      Value: SNFNewRequestHelper
    # Click on the corresponding call on the Home page.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_based_on_participant_name$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_based_on_participant_name$
    # Right side of screen refreshes to show the associated call pane with proper name and primary information as header.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    # Remove the call from call queue.
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.snf_call_portal.end_call_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.snf_call_portal.end_call_button$
    # Verify that the "Call already answered" toast notification appears indicating that call has been already answered.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_notifications.call_already_answered_notification$
    # Verify that screen resets without a refresh being required - with the call and related pane disappearing.
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    # Fill up SNF Post Call Survey.
    - Type: case
      Value: SNFGreatPostCallSurvey
    # Calling Prompt cleaner
    - Type: case
      Value: SeniorCleanPrompts
    # Starting second scenario where another Care Platform user takes the call before the provider does.
    - Type: case
      Role: desktopChrome1
      Value: ProviderLoginSecondaryUser
    - Type: case
      Role: desktopChrome1
      Value: ProviderEndCurrentCall
    # Call Provider from SNF.
    - Type: case
      Value: SNFNewRequestHelper
    # Click on the corresponding call on the Home page.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_based_on_participant_name$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_based_on_participant_name$
    # Right side of screen refreshes to show the associated call pane with proper name and primary information as header.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    # Answer the call as another care platform user.
    - Type: case
      Role: desktopChrome1
      Value: AnswerCallAsProvider
    # Verify that the "Call already answered" toast notification appears indicating that call has been already answered.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_notifications.call_already_answered_notification$
    # Verify that screen resets without a refresh being required - with the call and related pane disappearing.
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    # Complete call.
    # Click the end call button.
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.snf_call_portal.end_call_button$
    # Provider fills up the Post Call Survey.
    - Type: case
      Role: desktopChrome1
      Value: PostCallSurveyProvider

#CXTB-139: Providers - EHP - See Call Appear in Queue, Assign and Review Details.
TestProvidersEHPSeeCallAppearInQueueAssignAndReviewDetails:
  Environment: Settings
  Precases:
    - ProviderNewCleaner
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Calling EHP Login case.
    - Type: case
      Value: EmployeeHealthPortalLogIn
      Role: desktopChrome1
  # Clean EHP hanged calls.
    - Type: case
      Value: EmployeeHealthPortalCleanHangedCalls
      Role: desktopChrome1
  # Generate a call from EHP.
    - Type: case
      Value: EmployeeHealthPortalCallNow
      Role: desktopChrome1
  # Calling Login case on Provider Care Platform side.
    - Type: case
      Value: ProvidersCarePlatformLogin
  # Select the call on Providers Care Platform.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_calls$
  # Verify that the call information appears on the right side.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
  # Click "Assign to me" button on right to  review the Assessment describing the situation as populated by the employee portal user.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
  # Verify assigned column in the listing is updated to show that the call has been assigned to you.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_call_assigned_value$
      Property: textContent
      Value: Me
  # Click "Unassign" button in upper right side if something is going to prevent you from answering the call.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.unnasign_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.unnasign_button$
  # Assigned column is updated to return to "Unassigned".
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_call_assigned_value$
      Property: textContent
      Value: "—"
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_call_assigned_value$
      Greps:
        - var: CALL_ASSIGNED_VALUE
          match: (.*)
    - Type: assert
      Asserts:
        - Type: n_contain_encode_utf8
          Var: CALL_ASSIGNED_VALUE
          Value: Me
  # Click "Assign to me" button on right to  review the Assessment describing the situation as populated by the employee portal user.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
  # Verify assigned column in the listing is updated to show that the call has been assigned to you.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_home_page.on_demand_call_assigned_value$
      Property: textContent
      Value: Me
  # Verify you can expand then view employee’s Call history in lower portion.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.call_history_title_tab$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.call_history_title_tab$
  # Verify that user can expand then view employee’s Call history in lower portion.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.call_history_tabs_content$
    - Type: case
      Value: EmployeeHealthPortalLogOut 
      Role: desktopChrome1

# CXTB-153 Call SNF Device for Follow-up Task from Home (Answered)
TestProvidersCallSNFDeviceForFollowUpTaskFromHome:
  Environment: Settings
  Precases:
    - ProviderNewCleaner
  Aftercases:
    - TerminateApp
    - CleanUsedFollowUp
    - ProviderEndCurrentCall
  Roles:
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 100
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
    # Call login for nurses
    - Type: case
      Role: localiOS
      Value: LoginSNFHelper
    # Clean any prompt notification from the start
    - Type: case
      Role: localiOS
      Value: SeniorCleanPrompts
    - Type: case
      Value: CreateAFollowUpForSNFCall
    # Skip the survey.
    - Type: wait_for
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_post_call_survey.skip_survey_button$
    - Type: click
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_post_call_survey.skip_survey_button$
    # Navigate again to home
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.home_button$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.home_title$
    # Select a Follow-Up Call
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.follow_up_calls$
    - Type: sleep
      Role: desktopChrome
      Time: 1
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.call_device_button$
    - Type: sleep
      Time: 2
      Role: desktopChrome
    # Nurse answers the call from Provider.
    - Type: case
      Value: SNFAnswerIncomingCall
      Role: localiOS
    # End call in Provider
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    # Provider fills up the Post Call Survey.
    - Type: case
      Value: PostCallSurveyProvider
    # After call ends, select the Great option answer and then verify that the Nurse is redirected to the Home Page.
    - Type: case
      Value: SNFGreatPostCallSurvey
      Role: localiOS

# CXTB-122 Seniors - See Call Appear in Queue, Assign and Review Details
TestProviderSeniorSeeCallAppearInQueueAssignAndReviewDetails:
  Environment: Settings
  Precases:
    - AdminOnCallRefreshParticipant
    - LoginNeverAloneHelper
    - CarePartnerCleanCallQueueAndHangedCalls
    - ProviderNewCleaner
    - SeniorCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Generate a medical call as a senior.
    - Type: case
      Value: CallCarePartner
  # Login and answer call as a care partner,
    - Type: case
      Value: AnswerCallAsCarePartner
  # Wait for the call to start.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.end_call_button$
  # Verify video is disabled by default on the seniors.
    - Type: wait_not_visible
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
  # Click "Medical" button in video call window so the participant speaks to a doctor while on the call.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_transfer_btn$
  # "Telehealth request form" appears to the left of video call window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Fill in the required fields:
  # Priority level, Reason for request and When did symptoms start?
  # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$
  # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.first_reason_for_request_available_option$
  # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
  # Click on "Submit".
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
  # Telehealth request form window disappears.
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.telehealth_request_form_header$
  # Verify "End Call" button has been replaced with "Leave Call" button.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
  # Log in as a provider and join the call
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
  # Select the call
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
  # Assign to "Me"
    - Type: wait_for  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
      Role: desktopChrome1
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
      Role: desktopChrome1
    - Type: sleep
      Time: 0.8
      Role: desktopChrome1
    # Check Assigment
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row_button$
      Role: desktopChrome1
      Greps:
      - var: SELECTED_CALL
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts: 
        - Type: contain
          Var: SELECTED_CALL
          Value: 'Me'
  # Verify you can expand Call history in lower portion.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab_situation_title$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.health_overview_subtab$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.medication_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.providers_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.expand_lower_portion$
      Role: desktopChrome1
    - Type: wait_for_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.expand_lower_portion$
      Attribute: innerText
      Value: Minimize
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.call_history_tab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.follow_up_tickets_tab$
      Role: desktopChrome1
    # Answer call
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
    - Type: sleep
      Time: 2
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    # End Call and Close Session
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    - Type: case
      Value: PostCallSurveyProvider
      Role: desktopChrome1

#CXTB-666 IDD - CH - See Call Appear in Queue, Assign and Review Details
TestProviderIDDCHSeeCallAppearInQueueAssignAndReviewDetails:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Go Off Shift"
  Precases:
    - AdminOnCallRefreshCHParticipant
    - LoginCHIDDNeverAloneHelper
    - CHCarePartnerCleanCallQueueAndHangedCalls
    - ESProviderCleaner
    - IDDESParticipantCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Make IDD-CarePartner-Provider Medical Transfer
    - Type: case
      Value: IDDCHCarePartnerMakeCallToProvider
  # Log in as a provider and join the call
    - Type: case
      Value: ESProvidersCarePlatformLogin
      Role: desktopChrome1
  # Select the call
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
  # Check Row values
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row_button$
      Role: desktopChrome1
      Greps:
      - var: MEDICAL_TRANSFER_CALL
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    # Checking call origin
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL
          Value: 'Participant (CH)'
    # Checking IDD Participant Name
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL
          Value: '$AND_CLI_idd_ch_never_alone_user2_name$ $AND_CLI_idd_ch_never_alone_user2_lastname$'
  # Wait 5 seconds for the call to disappear
    - Type: sleep
      Time: 5
    - Type: wait_not_visible
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
  # Log out from ES Provider
    - Type: case
      Value: CarePlatformLogout
      Role: desktopChrome1
  # Log in to CHS Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
  # Check values of row
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row_button$
      Role: desktopChrome1
      Greps:
      - var: MEDICAL_TRANSFER_CALL_CH
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    # Checking call origin
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL_CH
          Value: 'Participant (ESP)'
    # Checking IDD Participant Name
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL_CH
          Value: '$AND_CLI_idd_ch_never_alone_user2_name$ $AND_CLI_idd_ch_never_alone_user2_lastname$'
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
  # Assign to "Me"
    - Type: wait_for  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
      Role: desktopChrome1
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
      Role: desktopChrome1
    - Type: sleep
      Time: 0.8
      Role: desktopChrome1
    # Check Assigment
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row_button$
      Role: desktopChrome1
      Greps:
      - var: SELECTED_CALL
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: SELECTED_CALL
          Value: 'Me'
  # Verify you can expand Call history in lower portion.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab_situation_title$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.health_overview_subtab$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.medication_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.providers_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.expand_lower_portion$
      Role: desktopChrome1
    - Type: wait_for_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.expand_lower_portion$
      Attribute: innerText
      Value: Minimize
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.call_history_tab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.follow_up_tickets_tab$
      Role: desktopChrome1
    # Answer call
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
    - Type: sleep
      Time: 2
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    # End Call and Close Session
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    - Type: case
      Value: PostCallSurveyProvider
      Role: desktopChrome1

#CXTB-666 IDD - ES - See Call Appear in Queue, Assign and Review Details
TestProviderIDDESSeeCallAppearInQueueAssignAndReviewDetails:
  Environment: Settings
  Precases:
    - AdminOnCallRefreshESParticipant
    - LoginESIDDNeverAloneHelper
    - ESCarePartnerCleanCallQueueAndHangedCalls
    - ESProviderCleaner
    - IDDESParticipantCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Make IDD-CarePartner-Provider Medical Transfer
    - Type: case
      Value: IDDESCarePartnerMakeCallToProvider
  # Log in as a provider and join the call
    - Type: case
      Value: ESProvidersCarePlatformLogin
      Role: desktopChrome1
  # Select the call
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
  # Check Row values
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row_button$
      Role: desktopChrome1
      Greps:
      - var: MEDICAL_TRANSFER_CALL
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    # Checking call origin
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL
          Value: 'Participant (ES)'
    # Checking IDD Participant Name
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL
          Value: '$AND_CLI_idd_es_never_alone_user1_name$ $AND_CLI_idd_es_never_alone_user1_lastname$'
  # Wait 5 seconds for the call to disappear
    - Type: sleep
      Time: 5
    - Type: wait_not_visible
      Strategy: xpath
      Role: desktopChrome1
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
  # Log out from ES Provider
    - Type: case
      Value: CarePlatformLogout
      Role: desktopChrome1
  # Log in to CHS Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
  # Check values of row
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row_button$
      Role: desktopChrome1
      Greps:
      - var: MEDICAL_TRANSFER_CALL_ES
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    # Checking call origin
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL_ES
          Value: 'Participant (ESP)'
    # Checking IDD Participant Name
    - Type: assert
      Asserts: 
        - Type: contain_encode_utf8
          Var: MEDICAL_TRANSFER_CALL_ES
          Value: '$AND_CLI_idd_es_never_alone_user1_name$ $AND_CLI_idd_es_never_alone_user1_lastname$'
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
  # Assign to "Me"
    - Type: wait_for  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
      Role: desktopChrome1
    - Type: click  
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_me_button$
      Role: desktopChrome1
    - Type: sleep
      Time: 0.8
      Role: desktopChrome1
    # Check Assigment
    - Type: get_attribute  
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row_button$
      Role: desktopChrome1
      Greps:
      - var: SELECTED_CALL
        attr: innerHTML
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts: 
        - Type: contain
          Var: SELECTED_CALL
          Value: 'Me'
  # Verify you can expand Call history in lower portion.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.assessment_subtab_situation_title$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.health_overview_subtab$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.medication_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.providers_subtab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.expand_lower_portion$
      Role: desktopChrome1
    - Type: wait_for_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.expand_lower_portion$
      Attribute: innerText
      Value: Minimize
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.call_history_tab$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_details_page.follow_up_tickets_tab$
      Role: desktopChrome1
    # Answer call
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
    - Type: sleep
      Time: 2
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    # End Call and Close Session
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    - Type: case
      Value: PostCallSurveyProvider
      Role: desktopChrome1

#CXTB-668 IDD - Answer Call and Complete Session
TestProviderIDDCHAnswerCallAndCompleteSession:
  Environment: Settings
  Precases:
    - AdminOnCallRefreshCHParticipant
    - LoginCHIDDNeverAloneHelper
    - CHCarePartnerCleanCallQueueAndHangedCalls
    - ESProviderCleaner
    - IDDESParticipantCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Make IDD-CarePartner-Provider Medical Transfer
    - Type: case
      Value: IDDCHCarePartnerMakeCallToProvider
  # Wait 5 seconds for the call to disappear
    - Type: sleep
      Time: 5
      Role: desktopChrome1
  # Log in to CHS Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
  # Answer Call
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
  # Call portal should be displayed and the user status has been automatically updated to "In session" (red dot).
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
      Role: desktopChrome1
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Role: desktopChrome1
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-red'
  # Verify video is disabled by default on the Providers.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Role: desktopChrome1
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
    - Type: sleep
      Time: 2
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
  # End Call and Close Session
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "false"
  # Click on the complete session button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
  # Fill the notes
  # Verify that the "Complete Session" is disabled.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "true"
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Role: desktopChrome1
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Role: desktopChrome1
      Value: 'Automation subject CXTB-668'
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: 'Automation notes CXTB-668'
      Role: desktopChrome1
  # Fill the Post-call Survey
  # Select Resolved to YES
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$
      Role: desktopChrome1
  # Click on Cancel button
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.cancel_exit_session_button$
      Role: desktopChrome1
  # Go back to Call Portal
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "false"
  # Click on the complete session button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
  # Verify that the "Complete Session" is disabled.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "true"
  # Select Resolved to NO
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_no_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_no_option$
      Role: desktopChrome1
  # Survey updates based on this response:
  # New "Reason" field appears.
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_input$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.first_reason_option$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_no_option$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Role: desktopChrome1
      Value: 'Automation subject CXTB-668'
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: 'Automation notes CXTB-668'
      Role: desktopChrome1
  # "Follow-up recommended" is automatically selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.follow_up_recommended_checkbox$
      Attribute: value
      Value: true
  # Fill other options
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.video_visit_true_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.video_visit_true_option$
      Role: desktopChrome1
  # New time options appear below Follow-up recommended checkbox, with "1 hour" selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.selected_follow_up_time_option$
      Attribute: value
      Value: "1"
  # "Assign to myself" box appears and is automatically selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_myself_checkbox$
      Attribute: value
      Value: true
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
  # Wait for Notification
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_notifications.call_completed_notification$
  # User is redirected to the Home Listing page with the new Follow-up ticket included in the listing.
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$
  # Go back to Available
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Role: desktopChrome1
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Role: desktopChrome1
      Attribute: className
      ResultVar: IS_GREEN
    - Type: assert
      Asserts:
        - Type: contain
          Var: IS_GREEN
          Value: is-green
  # Set Time to all so the follow-up appears.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Role: desktopChrome1
      Condition:
        - Value: 5
          Operation: visible
          Result: true
  # Close ticket so it cleans the Home queue.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.ch_follow_up_ticket_based_on_participant_name$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.ch_follow_up_ticket_based_on_participant_name$
      Role: desktopChrome1
    - Type: sleep
      Time: 1
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
      Role: desktopChrome1
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
      Role: desktopChrome1
      Value: 'Automation Test Close Ticket'
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.save_and_close_ticket_button$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_notifications.follow_up_ticket_closed_notification$
      Role: desktopChrome1

#CXTB-668 IDD - Answer Call and Complete Session
TestProviderIDDESAnswerCallAndCompleteSession:
  Environment: Settings
  Precases:
    - AdminOnCallRefreshESParticipant
    - LoginESIDDNeverAloneHelper
    - ESCarePartnerCleanCallQueueAndHangedCalls
    - ESProviderCleaner
    - IDDESParticipantCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Make IDD-CarePartner-Provider Medical Transfer
    - Type: case
      Value: IDDESCarePartnerMakeCallToProvider
  # Wait 5 seconds for the call to disappear
    - Type: sleep
      Time: 5
      Role: desktopChrome1
  # Log in to CHS Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
  # Answer Call
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
      Role: desktopChrome1
  # Call portal should be displayed and the user status has been automatically updated to "In session" (red dot).
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
      Role: desktopChrome1
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Role: desktopChrome1
      Greps:
        - var: INDICATOR
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: INDICATOR
          Value: 'is-red'
  # Verify video is disabled by default on the Providers.
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_camera_button$
      Role: desktopChrome1
      Greps:
        - var: CLASS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CLASS
          Value: 'off'
    - Type: sleep
      Time: 2
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
  # End Call and Close Session
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Role: desktopChrome1
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "false"
  # Click on the complete session button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
  # Fill the notes
  # Verify that the "Complete Session" is disabled.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "true"
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Role: desktopChrome1
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Role: desktopChrome1
      Value: 'Automation subject CXTB-668'
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: 'Automation notes CXTB-668'
      Role: desktopChrome1
  # Fill the Post-call Survey
  # Select Resolved to YES
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$
      Role: desktopChrome1
  # Click on Cancel button
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.cancel_exit_session_button$
      Role: desktopChrome1
  # Go back to Call Portal
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "false"
  # Click on the complete session button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
  # Verify that the "Complete Session" is disabled.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      Role: desktopChrome1
      Property: disabled
      Value: "true"
  # Select Resolved to NO
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_no_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_no_option$
      Role: desktopChrome1
  # Survey updates based on this response:
  # New "Reason" field appears.
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_input$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.first_reason_option$
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_no_option$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Role: desktopChrome1
      Value: 'Automation subject CXTB-668'
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: 'Automation notes CXTB-668'
      Role: desktopChrome1
  # "Follow-up recommended" is automatically selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.follow_up_recommended_checkbox$
      Attribute: value
      Value: true
  # Fill other options
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.video_visit_true_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.video_visit_true_option$
      Role: desktopChrome1
  # New time options appear below Follow-up recommended checkbox, with "1 hour" selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.selected_follow_up_time_option$
      Attribute: value
      Value: "1"
  # "Assign to myself" box appears and is automatically selected.
    - Type: wait_for_attribute
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.assign_to_myself_checkbox$
      Attribute: value
      Value: true
    - Type: click
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
  # Wait for Notification
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_notifications.call_completed_notification$
  # User is redirected to the Home Listing page with the new Follow-up ticket included in the listing.
    - Type: wait_for
      Role: desktopChrome1
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$
  # Go back to Available
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Role: desktopChrome1
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Role: desktopChrome1
      Attribute: className
      ResultVar: IS_GREEN
    - Type: assert
      Asserts:
        - Type: contain
          Var: IS_GREEN
          Value: is-green
  # Set Time to all so the follow-up appears.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_dropdown$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.time_all_option$
      Role: desktopChrome1
      Condition:
        - Value: 5
          Operation: visible
          Result: true
  # Close ticket so it cleans the Home queue.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.ch_follow_up_ticket_based_on_participant_name$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.ch_follow_up_ticket_based_on_participant_name$
      Role: desktopChrome1
    - Type: sleep
      Time: 1
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
      Role: desktopChrome1
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
      Role: desktopChrome1
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_home_page.reason_for_closing_ticket_input$
      Role: desktopChrome1
      Value: 'Automation Test Close Ticket'
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.save_and_close_ticket_button$
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_notifications.follow_up_ticket_closed_notification$
      Role: desktopChrome1

# CXTB-681: Call Seniors Device for Follow-up Task from Home (Ignored).
TestProviderCallParticipantForFollowUpTaskFromHomeAndIgnore:
  Environment: Settings
  Vars:
  # Log out option
    LOGOUT_OPTION: "Go Off Shift"
  Precases:
    - LoginNeverAloneHelper
    - ProviderNewCleaner
    - SeniorCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
  # Call Participant logged in as a Provider.
    - Type: case
      Value: CreateAFollowUpForParticipantCall
  # Navigate again to home
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.home_button$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.home_title$
    # Select a Follow-Up Call
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.follow_up_calls$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.follow_up_calls$
    - Type: sleep
      Role: desktopChrome
      Time: 1
    # Verify call information appears on the screen
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.call_device_button$
    # Call back to the device
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.call_device_button$
    # Check you are in the call portal
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    # Participant must select the ignore option once the call prompt is available
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.ignore_call_button$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.ignore_call_button$
    # Video window updates to indicate the user is not available and to present the option for you to leave a text message
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.no_message_button$
    # Click "No message" to end the process without sending the device a message
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.no_message_button$
    # Call portal returns to Home page and call continues to show as it did in listing
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.home_title$
    # Clean Follow up
    - Type: case
      Value: CleanUsedFollowUp

#CXTB-680 IDD - CH - Return Missed IDD (Easterseals) Call from Home (Answered)
TestProviderIDDCHReturnMissedCallFromHome:
  Environment: Settings
  Precases:
    - AdminOnCallRefreshCHParticipant
    - LoginCHIDDNeverAloneHelper
    - CHCarePartnerCleanCallQueueAndHangedCalls
    - ESProviderCleaner
    - IDDESParticipantCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome1
      App: desktop
  Actions:
  # Make IDD-CarePartner-Provider Medical Transfer
    - Type: case
      Value: IDDCHCarePartnerMakeCallToProvider
  # Wait 5 seconds for the change of call center from ES to CHS
    - Type: sleep
      Time: 5
      Role: desktopChrome1
  # Log in to CHS Provider
    - Type: case
      Value: ProvidersCarePlatformLogin
      Role: desktopChrome1
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
      Role: desktopChrome1
  # Making the missed call
    - Type: sleep
      Time: 61
    - Type: click
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_call.end_call_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.missed_call$
      Role: desktopChrome1
  # Select the missed call
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.missed_call$
      Role: desktopChrome1
  # Check call row attributes
  #  - Type: get_attribute  
  #    Strategy: xpath
  #    Id: $PAGE.providers_home_page.missed_call$
  #    Role: desktopChrome1
  #    Greps:
  #    - var: MISSED_CALL
  #      attr: innerHTML
  #      condition: nempty
  #      match: "(.*)"
    # Checking call origin
  #  - Type: assert
  #    Asserts: 
  #      - Type: contain_encode_utf8
  #        Var: MISSED_CALL
  #        Value: 'Participant (CH)'
    # Checking IDD Participant Name
  #  - Type: assert
  #    Asserts: 
  #      - Type: contain_encode_utf8
  #        Var: MEDICAL_TRANSFER_CALL
  #        Value: '$AND_CLI_idd_ch_never_alone_user2_name$ $AND_CLI_idd_ch_never_alone_user2_lastname$'
    # Assign to "Me"
  #  - Type: wait_for  
  #    Strategy: xpath
  #    Id: $PAGE.providers_call_handling_page.call_update_dropdown_button$
  #  - Type: click  
  #    Strategy: xpath
  #    Id: $PAGE.providers_call_handling_page.call_update_dropdown_button$
  #  - Type: click  
  #    Strategy: xpath
  #    Id: $PAGE.providers_call_handling_page.assign_to_me_button$
  #  - Type: sleep
  #    Time: 0.8
  # Call Device
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_device_btn$
      Role: desktopChrome1
    