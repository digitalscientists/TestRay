
# CXTB-185 Provider Can Click and View Facility Device Record from Listing
TestProviderCanClickAndViewFacilitiesDevice:
  Environment: Settings
  Vars:
    DEVICE_STATUS: "(Active|Pre-delivery|Suspended|Deactivated)"
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
    # Login-in provider Care Partner
    - Type: case
      Value: ProvidersCarePlatformLogin
    # Click facilities button
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facilities_button$
    # click on the first listing record
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_based_on_name$
    # Click on Overview button and verify if tab showing belongs to Overview
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.overview_button$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.tabs_content$
      Greps:
      - var: TAB_CLASS
        attr: tab-title
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts:
      - Type: contain
        Var: TAB_CLASS
        Value: 'Overview'
    # Click on Local Hospital button and verify if tab showing belongs to Local Hospital
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.local_hospitals_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.title_subtab_local_hospital$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.tabs_content$
      Greps:
      - var: TAB_TITLE
        attr: tab-title
        condition: nempty
        match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TAB_TITLE
          Value: 'Local Hospitals'
    # Click on Devices button and verify if tab showing belongs to Devices
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.devices_tab$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.title_subtab_devices$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.tabs_content$
      Greps:
        - var: TAB_TITLE
          attr: tab-title
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TAB_TITLE
          Value: 'Devices'
    # Click on Record button and check the Devices
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.records_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_records_page.info_title$
    # Click to check Devices Tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_records_page.devices_tab$
    - Type: sleep
      Time: 2
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_facilities_records_page.device_status$
      Greps:
        - var: STATUS_TEXT
          condition: nempty
          match: "(Active|Pre-delivery|Suspended|Deactivated)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: DEVICE_STATUS
          Value: $AND_CLI_STATUS_TEXT$
  
# CXTB-186 Can Click and View Facility Device Call History & Access Call Recordings
TestProviderReviewFacilityDeviceCallHistoryAndAccessCallRecordings:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Go Off Shift"
  Precases:
    - MakeCallBetweenProviderAndSNF
  Aftercases:
    - CarePlatformLogout
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
  Actions:
  # Log in with provider
    - Type: case
      Value: ProvidersCarePlatformLogin
  # Go to Facilities
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facilities_button$
  # click on the facility
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_based_on_name$
  # Go to Records
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.records_button$
  # Click on Call History tab
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.call_history_tab$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_records.call_history_tab$
  # Call History listing
  # Expand row entry, check details
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.first_call_row$
      Time: 10
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.first_call_row$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.first_call_row$
      Greps:
        - var: CALL_IS_OPEN
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: CALL_IS_OPEN
          Value: 'is-open'
  # Check telehealth request form
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_facility_call_button$
    # Open Telehealth request Modal
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_facility_call_button$
      # Telehealth modal form
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_modal_title$
      # Patient subtitle
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_patient_information_subtitle$
      # Situation subtitle
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_situation_subtitle$
      # Assesment situation
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_assessment_subtitle$  
      # Close telehealth modal
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_close_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.telehealth_form_close_button$
  # Click play button on call recording, check you can pause it
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.play_pause_recording_button$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.play_pause_recording_button_status$
      Greps:
        - var: PLAY_RECORDING_STATUS
          attr: class
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: PLAY_RECORDING_STATUS
          Value: '-paused'
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_history_page.play_pause_recording_button$

#CXTB-663 Review Info for Existing Facility Device - Facility Pane
TestProviderReviewInfoForExistingFacilityDeviceFacilityPane:
  Environment: Settings
  Roles: 
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Call to login case as a Provider.
    - Type: case
      Value: ProvidersCarePlatformLogin
  # Navigate to Facilities.
    - Type: case
      Value: ProviderNavigateToFacilities
  # Select a facility with an address and at least one device in listing.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_based_on_name$
  # Right side of screen updates to show the selected facility’s summary pane including:
  # Facility’s local time, Overview, Local Hospitals, Devices
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_name$
  # Using Facility leadership page objects to avoid duplication.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.facility_leadership_facility_details.facility_local_time$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.overview_tab$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility.local_hospitals_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.devices_button$
  # Click "Devices" on right side.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.devices_button$
  # Right side of screen updates to show listing of facility’s device(s) and their current status.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.facility_status_label_elements$

# BUG: CHS-2603 TC: CXTB-669 Forced Assessment View on Calls for Follow-ups without Telehealth Request
TestProviderCheckForForcedAssessmentOnFollowUpsWithoutTelehealthRequest:
  Environment: Settings
  Roles: 
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
  Precases:
    - ProviderNewCleaner
  Aftercases:
    - CleanUsedFollowUp
    - TerminateApp  
  Actions:
    #Call login for nurses
    - Type: case
      Role: localiOS
      Value: LoginSNFHelper
    #Clean SNF prompts
    - Type: case
      Role: localiOS
      Value: SeniorCleanPrompts
    #Clean any prompt notification from the start
    - Type: case
      Value: CreateAFollowUpForSNFCall
    # Skip the survey.
    - Type: wait_for
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_post_call_survey.skip_survey_button$
    - Type: click
      Strategy: class_chain
      Role: localiOS
      Id: $PAGE.seniors_app_post_call_survey.skip_survey_button$
    # Navigate again to home
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.home_button$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.home_title$
    # Select a Follow-Up Call
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.follow_up_calls$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.follow_up_calls$
    - Type: sleep
      Role: desktopChrome
      Time: 1
    # Looking for Assessment Tab, it shouldn't be
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.nav_tab$
      Role: desktopChrome
      Greps:
        - var: FOLLOW_UP_TABS
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: n_contain
          Var: FOLLOW_UP_TABS
          Value: 'Assessment'
    # Call back to the device
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.call_device_button$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.call_device_button$
    # Check you are in the call portal
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    # Check there's no Assessment here neither
    - Type: get_attribute
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.nav_tab$
      Greps:
        - var: FOLLOW_UP_TAB_CALL_PORTAL
          attr: innerHTML
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: n_contain
          Var: FOLLOW_UP_TAB_CALL_PORTAL
          Value: 'Assessment'
    # End the call
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.no_message_button$

# CXTB-725 Review Info for Existing Facility Device - Facility Profile
TestProviderReviewInfoForExistingFacilityDeviceFacilityProfile:
  Environment: Settings
  Vars:
    DEVICE_STATUS: "(Active|Pre-delivery|Suspended|Deactivated)"
    LOGOUT_OPTION: "Go Off Shift"
  Aftercases:
    - CarePlatformLogout
  Roles: 
    - Role: desktopChrome
      App: desktop
  Actions:
  # Call to login case as a Provider.
    - Type: case
      Value: ProvidersCarePlatformLogin
  # Navigate to Facilities.
    - Type: case
      Value: ProviderNavigateToFacilities
  # Select a facility with an address and at least one device in listing.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_based_on_name$
  # Right side of screen updates to show the selected facility’s summary pane including:
  # Facility’s local time, Overview, Local Hospitals, Devices
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_name$
  # Using Facility leadership page objects to avoid duplication.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.facility_leadership_facility_details.facility_local_time$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.overview_tab$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility.local_hospitals_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.devices_button$
  # Click "Devices" on right side.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.devices_button$
  # Right side of screen updates to show listing of facility’s device(s) and their current status.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_facility_Record.facility_status_label_elements$
  # Click on Record
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant_details.records_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_records_page.info_title$
  # Click to check Devices Tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_records_page.devices_tab$
    - Type: sleep
      Time: 2
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.providers_facilities_records_page.device_status$
      Greps:
        - var: STATUS_TEXT
          condition: nempty
          match: "(Active|Pre-delivery|Suspended|Deactivated)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: DEVICE_STATUS
          Value: $AND_CLI_STATUS_TEXT$