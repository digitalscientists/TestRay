#CXTB-521 - CH Care Partner - Access Participant Directory and Filter
TestCHCarePartnerParticipantDirectoryFilter:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CHCarePartnerLogin
  #Go to participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
  #Get the value to compare later
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_darkened_letter_button$
      Greps:
        - var: LASTNAME_FILTER_LETTER
          match: "(.*)"
  #Click the first darkened letter button
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_darkened_letter_button$
  #Verify it was filtered by the selected letter
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_LETTER
          match: ^[a-zA-Z]   #The match selects: The first char from the starter word (^) that is a letter ([a-zA-Z])
    - Type: assert
      Asserts: 
      - Type: eq
        Var: LASTNAME_FIRST_LETTER
        Value: $AND_CLI_LASTNAME_FILTER_LETTER$
  #Remove the filter by letter
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.selected_darkened_letter_button$
  #Get the first lastname in the list
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT_NO_FILTER
          match: (.*)
  #Add the search filter
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.search_button$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_participant.search_input$
      Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  #Verify there is at least 1 user with that name
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
      Greps:
        - var: LASTNAME_FIRST_PARTICIPANT
          match: (.*)
  #Verify the first participant lastname contains the text filtered
    - Type: assert
      Asserts: 
      - Type: contain
        Var: LASTNAME_FIRST_PARTICIPANT
        Value: $AND_CLI_LASTNAME_FIRST_PARTICIPANT_NO_FILTER$
  #Clear the search by clicking small "x" at right of field
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.clear_search_button$
  #Verify there is at least 1 user
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.first_senior_lastname$
  #Click on an user
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_1_row$
  #Verify that a summary component is displayed
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$