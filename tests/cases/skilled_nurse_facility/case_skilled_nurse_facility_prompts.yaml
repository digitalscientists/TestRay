#CXTB-42: Verify Provider Incoming Call - Answer Call.
TestProviderIncomingCallAnswerCallOnSNF:
  Environment: Settings
  Precases:
    - LoginSNFHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
    # Generate a call from Provider to Facility Device.
    - Type: case
      Value: ProviderCallFacility
    # SNF Device begins ringing and automatically displays "Incoming Call".
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.incoming_call_header$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.incoming_call_header$
      Attribute: label
      ResultVar: HEADER_TITLE
    - Type: assert
      Asserts:
        - Type: eq
          Var: HEADER_TITLE
          Value: Incoming Call...
    # Verify it shows the details of who is calling, and presents the options to answer or ignore the call.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.called_name$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.called_name$
      Attribute: label
      ResultVar: CALLER_VALUE
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALLER_VALUE
          Value: Dr. $AND_CLI_provider_user1_name$ $AND_CLI_provider_user1_lastname$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.ignore_call_button$
    # Click the "Answer Call" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
    # Device screen updates shows the active call screen with a Provider.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$
    # Turn on Nurse camera.
    # - Type: click
    #   Strategy: class_chain
    #   Id: $PAGE.seniors_app_call.video_button$
    # Verify that a video tumbnail will appear in the upper right corner giving a preview of what the Provider is seeing.
    # - Type: wait_for
    #   Strategy: class_chain
    #   Id: $PAGE.seniors_app_call.video_window$
    # Click the end call button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_call.end_call_button$
    # Provider fills up the Post Call Survey.
    - Type: case
      Value: PostCallSurveyProvider
    # After call ends, select the Great option answer and then verify that the Nurse is redirected to the Home Page.
    # Select the Great option.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    # Verify page updates and shows Thank You for you feedback page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.thank_you_label$
    # Click the "To Home" button on Thank you for your feedback screen.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.to_home_button$
    # Checking the status indicator correspond to Available
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
    - Type: get_attribute
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-green"