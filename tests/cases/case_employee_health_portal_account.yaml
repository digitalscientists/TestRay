#CXTB-242: Set “Notifications” in “My account” Modal
TestSettingNotification:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_tab$
  #Select Notification Tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_tab$
  #Verifying text in the notification tab
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.employee_health_my_account_modal.notifications_text$
      Greps:
        - var: TITLE_TEXT
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TITLE_TEXT
          Value: Receive notifications 10 minutes before an appointment via
  #Checking that the checkboxes work: changes state with the click
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox_input$
      Greps:
      - var: ORIGINAL_EMAIL_VALUE
        attr: value
        match: "(.*)"
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox_input$
      Greps:
      - var: ORIGINAL_SMS_VALUE
        attr: value
        match: "(.*)"
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox_input$
      Greps:
      - var: NEW_EMAIL_VALUE
        attr: value
        match: "(.*)"
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox_input$
      Greps:
      - var: NEW_SMS_VALUE
        attr: value
        match: "(.*)"
    - Type: assert
      Asserts:
        - Type: ne
          Var: ORIGINAL_EMAIL_VALUE
          Value: $AND_CLI_NEW_EMAIL_VALUE$
    - Type: assert
      Asserts:
        - Type: ne
          Var: ORIGINAL_SMS_VALUE
          Value: $AND_CLI_NEW_SMS_VALUE$
  #Canceling changes. Modal should disappear.
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.cancel_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
  #Going back to My Account and Notification Tab
    - Type: case
      Value: NavigateToMyAccount
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_tab$
  #Checking state got undone when we canceled
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox_input$
      Greps:
      - var: ORIGINAL_EMAIL_VALUE_2
        attr: value
        match: "(.*)"
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox_input$
      Greps:
      - var: ORIGINAL_SMS_VALUE_2
        attr: value
        match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: ORIGINAL_EMAIL_VALUE
          Value: $AND_CLI_ORIGINAL_EMAIL_VALUE_2$
    - Type: assert
      Asserts:
        - Type: eq
          Var: ORIGINAL_SMS_VALUE
          Value: $AND_CLI_ORIGINAL_SMS_VALUE_2$
  #Checking checkboxes
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox$
  #Saving
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.save_changes_button$
  #Waiting for notification of success
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_updated_notification$