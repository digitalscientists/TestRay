ProvidersCarePlatformLogin:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:      
      # Login to Providers Care Platform
    - Type: maximize
    - Type: navigate
      Value: $AND_CLI_care_platform_url$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform_login_page.login_button$
      Greps:
      - var: login_text
        match: "Log In"
    - Type: assert
      Asserts: 
      - Type: eq
        Var: login_text
        Value: "Log In"  
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_login_page.email_input$
      Value: $AND_CLI_provider_user1$
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_login_page.password_input$
      Value: $AND_CLI_provider_user1_pwd$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_login_page.login_button$

ProvidersCarePlatformEndCall:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:      
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$
  #Selects on demand call
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.on_demand_calls$
  #Answer call
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    - Type: sleep
      Time: 3
  #End call
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
  #Fill the Provider's call notes
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Value: 'Automation Test subject'
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
      Value: 'Automation Test Notes: Test ProvidersCarePlatformEndCall'
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_save_button$
  #Manual save of notes
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_save_button$
  #Complete Session
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
      Property: disabled
      Value: "false"
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
  #Fill survey and end session
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.post_call_survey_title$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_yes_by_SNF$
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$

ProviderLoginSecondaryUser:
  Roles:
    - Role: desktopChrome
      App: desktop
  Actions:
    - Type: navigate
      Role: desktopChrome
      Value: $AND_CLI_care_platform_url$
    - Type: maximize
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_login.email_input$
      Value: $AND_CLI_provider_user2$
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_login.password_input$
      Value: $AND_CLI_provider_user2_pwd$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.care_platform_login.login_button$
    - Type: sleep
      Time: 2

JoinMedicalTransfer:
  Roles:
    - Role: desktopChrome
      App: desktop
  Actions:
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.last_medical_transfer_row$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$

# Post Call survey when the call ends.
PostCallSurveyProvider:
  Roles:
    - Role: desktopChrome
      App: desktop
  Actions:
    # Verify that the "Complete Session" is enabled.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
      Property: disabled
      Value: "false"
    # Click on the complete session button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
    # Fill the notes
    # Verify that the "Complete Session" is disabled.
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
      Property: disabled
      Value: "true"
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Value: Automation Call
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: Automation call            
    # Fill the Post-call Survey
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$             
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_yes_by_SNF$          
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_yes_by_SNF$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_notifications.call_completed_notification$

ProviderNavigateToParticipants:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    # Navigate to Participants.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_participants_page.participants_label$ 
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_participants_page.participants_label$ 
      Property: textContent
      Value: "Participants"

ProviderNavigateToFacilities:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    # Navigate to Facilities.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.facilities_navigation$
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facilities_header_title$ 
      Property: textContent
      Value: "Facilities"

ProviderCallParticipant:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    # Login to the Care Platform app with Providers account.
    - Type: case
      Value: ProvidersCarePlatformLogin
    # Navigate to Participants.
    - Type: case
      Value: ProviderNavigateToParticipants
    # Click the desired participant.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participants_page.senior_complete_name$
    # Click on the call portal button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_participant_modal.call_portal_button$
    # Call the participant.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_participant_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_participant_button$

ProviderCallFacility:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    # Login to the Care Platform app with Providers account.
    - Type: case
      Value: ProvidersCarePlatformLogin
    # Navigate to Facilities.
    - Type: case
      Value: ProviderNavigateToFacilities
    # Select the desired facility.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_based_on_name$ 
    # Navigate to the Devices tab.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.devices_tab$ 
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.devices_tab$
    # Find the corresponding facility device and then call it.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.call_based_on_device_button$ 
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.call_based_on_device_button$
    # Page updates to show call portal screen with "No active call" showing in video window.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.video_status$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.video_status$
      Greps:
        - var: CALL_MESSAGE
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: CALL_MESSAGE
          Value: 'No active call.'
    # Click on the Call Device button.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_device_btn$ 
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_device_btn$ 

ProviderSetStateCredential:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop
  Actions:
#Going to My Account
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.myaccount_menu_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_myaccount_info.modal_title$
  #Select credentials to answer call
    - Type: click
      Strategy: xpath
      Id : $PAGE.providers_account_modal.credentials_navigation_tab$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_account_modal.credentials_content$
    - Type: credentials_checkbox
      Strategy: xpath
      Option: check
      Id: $PAGE.providers_account_modal.indiana_option$
    - Type: credentials_checkbox
      Strategy: xpath
      Option: check
      Id: $PAGE.providers_account_modal.maryland_option$
    - Type: credentials_checkbox
      Strategy: xpath
      Option: check
      Id: $PAGE.providers_account_modal.pennsylvania_option$
    - Type: credentials_checkbox
      Strategy: xpath
      Option: check
      Id: $PAGE.providers_account_modal.west_virginia_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_account_modal.save_changes_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.providers_account_modal.credentials_content$

SetFollowUpTicket:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: desktop
    - Role: localiOS
      App: NeverAlone
  Actions:
      # Navigate to Facilities
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.facilities_navigation$
      # Select the Alpha center
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.alpha_center_td$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.call_portal_btn$
    - Type: case
      Role: localiOS
      Value: LoginSNFHelper
      # Call an SNF Facility
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_device_btn$      
      # Answer the call from SNF
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
      # Fill the notes
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Value: Follow-up Subject Automation
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: Follow-up Details Automation 
      # Close the call 
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      # Complete the call in SNF
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.to_home_button$
      # Complete the session 
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$
      # Set and Fill the follow up ticket
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_no_option$   
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.reason_last_option$     
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.time_follow_up_two_days_radiobtn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_session_btn$

SetScheduledCallTicket:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:   
      # Navigate to Participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
      # Open the Call Portal
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_complete_name$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.create_event_btn$    
      # Create the event
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.create_event_btn$    
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.category_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.teleheath_appointment_option$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.subject_input$
      Value: Automation test subject
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.date_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_call_portal.start_time_picker$
      Value: 800a
    - Type: send_keys
      Strategy: id
      Id: $PAGE.care_platform_call_portal.end_time_picker$
      Value: 900p
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.next_btn$
      # Filling the Situation fields
      # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$
      # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.first_reason_for_request_available_option$
      # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
      # Click in the submit button
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_create_event_btn$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_notifications.event_created_notification$
      # Navigate back to home 
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_home$

SetMissedCallTicket:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop   
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 100
      App: NeverAlone
  Actions:   
      # Navigate to Participants
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform.navigation_participant$
      # Open the Call Portal
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.senior_complete_name$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_participant.call_portal_btn$
      # Login to Seniors Never Alone App
    - Type: case
      Role: localiOS
      Value: LoginNeverAloneHelper
      # Call the participant
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.call_participant_btn$
      # Answer the call
    - Type: wait_for
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_incoming_call.answer_call_button$
      # Open the Meical Transfer
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_transfer_btn$
      # Fill the medical transfer fields
      # Urgent patient matter
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.urgent_patient_matter_yes_option$
      # Reason for request
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.reason_for_request_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.first_reason_for_request_available_option$
      # When did symptoms start      
    - Type: click
      Strategy: class
      Id: $PAGE.care_platform_call_portal.symptoms_start_input_container$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.today_date_date_picker$
      # Click in the submit button
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_btn$
      # Workaround: to make it appear Missed, it has to be waiting for 60 seconds. If appium passes 30+ seconds in sleep, it fails.
    - Type: sleep
      Role: localiOS
      Time: 61
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
      # Complete the call in Seniors App
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.end_call_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    - Type: click
      Role: localiOS
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.to_home_button$
      # Fill the notes
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Value: Missed Call Subject Automation
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: Missed Call Details Automation     
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$ 
      Property: disabled
      Value: "false"
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$             
      # Fill the Post-call Survey
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$             
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.issue_resolved_yes_radiobutton$          
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.category_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_question_option$
    - Type: click
      Strategy: id
      Id: $PAGE.care_platform_call_portal.subcategory_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.located_provider_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_and_exit_session_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_notifications.call_completed_notification$

ProviderSendsMessageToFacility:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    # Login to the Care Platform app with Providers account.
    - Type: case
      Value: ProvidersCarePlatformLogin
    # Navigate to Facilities.
    - Type: case
      Value: ProviderNavigateToFacilities
    # Select the desired facility.
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.facility_based_on_name$ 
    # Navigate to the Devices tab.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.devices_tab$ 
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.devices_tab$
    # Find the corresponding facility device and then call it.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.message_based_on_device_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.message_based_on_device_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.message_input$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.message_input$
      Value: $AND_CLI_MESSAGE_TO_FACILITY$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.send_message_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.send_message_button$
    - Type: sleep
      Time: 10
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.last_message_sent$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.providers_facilities_page.last_message_sent$
      Attribute: textContent
      ResultVar: LAST_MESSAGE_HISTORY
    - Type: assert
      Asserts:
        - Type: contain
          Var: LAST_MESSAGE_HISTORY
          Value: $AND_CLI_MESSAGE_TO_FACILITY$

ProviderCleanSlate:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    - Type: if
      If_Cases: 
        - If_Case: IfReturnSession
        - If_Case: ProviderVisibleEndCall
        - If_Case: CompleteEndCallOnProviderSide

#Clear un-ended sessions before test. Have Login
ProviderCleanBeforeTest:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Go Off Shift"
  Aftercases:
    - CarePlatformLogout
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    # Login to the Care Platform app with Providers account.
    - Type: case
      Value: ProvidersCarePlatformLogin
    - Type: case
      Value: ProviderCleanSlate

IfReturnSession:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.session_return_button$
      Condition:
        - Value: 5
          Operation: visible
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_home_page.session_return_button$
    - Type: case
      Value: ProviderVisibleEndCall

ProviderVisibleEndCall:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    #End call
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
      Condition:
        - Value: 5
          Operation: visible
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    - Type: case
      Value: CompleteEndCallOnProviderSide

CompleteEndCallOnProviderSide:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:      
  #Fill the Provider's call notes
      #If goes to survey de una vez, no habra call notes
    - Type: if
      If_Cases: 
        - If_Case: IfSaveNotes
  #Fill survey and end session
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.post_call_survey_title$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.resolved_true_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.recommend_discharge_yes_by_SNF$
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_home_page.home_title$

IfSaveNotes:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Condition:
        - Value: 5
          Operation: visible
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Value: 'Automation Test subject'
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
      Value: 'Automation Test Notes: Test ProvidersCarePlatformEndCall'
    - Type: scroll_to
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_save_button$
  #Manual save of notes
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.call_notes_save_button$
  #Complete Session
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 
      Property: disabled
      Value: "false"
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.complete_session_button$ 

CreateAFollowUpForSNFMissedCall:
  Roles:
    - Role: desktopChrome
      App: desktop  
  Actions:
  #Create follow-up call
    #Generate a call from Provider to Facility Device.
    - Type: case
      Value: ProviderCallFacility
    - Type: sleep
      Time: 3
    - Type: case
      Value: SNFAnswerIncomingCall
    #End call in Provider
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.end_call_btn$
    #Fill the Provider's call notes
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
    - Type: clear_field
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
    - Type: send_keys
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.call_notes_subject_input$
      Value: 'Automation Test subject'
    - Type: clear_field
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
    - Type: send_keys
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.call_notes_provider_input$
      Value: 'Automation Test Notes: Test TestSNFMissedCallFromProvider'
    - Type: if
      If_Cases: 
        - If_Case: IfSaveNotes
    #Fill survey for follow-up
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.post_call_survey_title$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.resolved_no_option$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.reason_input$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.reason_input$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.follow_up_reason_option$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.follow_up_now_option$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.recommend_discharge_no_option$
    - Type: scroll_to
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_call_handling_page.submit_exit_session_button$

CleanUsedFollowUp:
  Roles:
    - Role: desktopChrome
      App: desktop  
  Actions:
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.update_status_dropdown$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.status_option_close_ticket$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.close_ticket_modal_title$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.providers_follow_up_call_details_page.close_ticket_reason_input$
      Value: 'Automation Test Cleaning'
    - Type: click
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_follow_up_call_details_page.close_ticket_save_button$
    - Type: wait_for
      Strategy: xpath
      Role: desktopChrome
      Id: $PAGE.providers_home_page.toast_closed_ticket$  

AnswerCallAsProvider:
  Roles:
    - Role: desktopChrome
      App: desktop  
  Actions:
  # Click on the corresponding call on the Home page to and click on the "Answer" button.
    - Type: wait_for
      Strategy: xpath
      Id : $PAGE.providers_home_page.call_based_on_participant_name$
    - Type: click
      Strategy: xpath
      Id : $PAGE.providers_home_page.call_based_on_participant_name$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.answer_call_button$