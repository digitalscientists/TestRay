EmployeeHealthPortalGoSignUp:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:      
    - Type: maximize
    - Type: navigate
      Role: desktopChrome
      Value: $AND_CLI_employee_health_url$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_login_page.sign_up_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_login_page.sign_up_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_signup_page.first_name_input$

EmployeeHealthPortalLogIn:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:      
    - Type: maximize
    - Type: navigate
      Role: desktopChrome
      Value: $AND_CLI_employee_health_url$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_login_page.log_in_button$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_login_page.email_input$
      Value: $AND_CLI_employee_user1$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_login_page.password_input$
      Value: $AND_CLI_employee_user1_pwd$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_login_page.log_in_button$

#CXTB-233 Navigate to My Account
NavigateToMyAccount:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions:
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.user_dropdown_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.user_dropdown_menu$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.dropdown_option_myaccount$

CaseDeletePhoneNumber:
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions: 
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_input$
      Value: backspace

EmployeeHealthPortalLogOut: 
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions: 
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.user_dropdown_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.dropdown_option_logout$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_login_page.log_in_button$

#CXTB-241 “Update password” Workflow in My account Modal
EmployeeHealthPortalUpdateAccountPassword:
  Vars:
    ENV_PASS_STORE: $AND_CLI_employee_user1_pwd$ 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
    - Type: wait_for_page_to_load
      Time: 5
  #Go to Update Password tab and check components visibility
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_tab$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_new$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_confirm$
  #Try incorrect current password
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
      Value: "wrongPass!23"
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_new$
      Value: $AND_CLI_alternative_correct_password$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_confirm$
      Value: $AND_CLI_alternative_correct_password$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_change_button$
  #Wait for failure alert
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_failed_update_password$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_cancel_button$  
  #Verify the dialog is closed
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
      Time: 5
  #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
    - Type: wait_for_page_to_load
      Time: 5
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_tab$
  #Check requirements
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_requirements_text_section$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_requirements_text_section$
      Greps:
        - var: PASSWORD_REQUIREMENTS
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: PASSWORD_REQUIREMENTS
          Value: 'at least 8 characters'
    - Type: assert
      Asserts:
        - Type: contain
          Var: PASSWORD_REQUIREMENTS
          Value: 'one special character'
  #Fill the fields correctly
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
      Value: $AND_CLI_employee_user1_pwd$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_new$
      Value: $AND_CLI_alternative_correct_password$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_confirm$
      Value: $AND_CLI_alternative_correct_password$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_change_button$
  #Wait for success alert
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_success_update_password$
  #Log Out
    - Type: case
      Value: EmployeeHealthPortalLogOut
  #Setting the password var to the new value
    - Type: set_env_var
      Value: $AND_CLI_alternative_correct_password$
      Var: employee_user1_pwd
  #Log In with new credentials
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Verify the login with the new password was successful
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.user_profile_contact_info$
  #Restore original password
    - Type: case
      Value: NavigateToMyAccount
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
    - Type: wait_for_page_to_load
      Time: 5
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_tab$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
      Value: $AND_CLI_employee_user1_pwd$
      #Restore variables
    - Type: set_env_var
      Value: $AND_CLI_ENV_PASS_STORE$
      Var: employee_user1_pwd
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_new$
      Value: $AND_CLI_employee_user1_pwd$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_confirm$
      Value: $AND_CLI_employee_user1_pwd$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_change_button$
      #Wait for success alert
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_success_update_password$  
      #Log Out
    - Type: case
      Value: EmployeeHealthPortalLogOut

#Employee Health Portal - User Call Now helper
EmployeeHealthPortalUserCall:
  Vars:
    STATE: IN
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Home Page
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.call_now_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.call_now_button$
  #Telehealth on demand modal
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_title$
  #Cancel should take you back to the Home Page
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_cancel_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_title$
  #Going back to the Telehealth on demand modal
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.call_now_button$  
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_state_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_state_select_option$
  #Try to call without all fields filled
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_call_provider_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_reasons_error$
  #Fill all fields
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_patient_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_patient_select_option$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_reasons_input$
      Value: 'Test reason: automation'
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_call_provider_button$
  #Call page
  #Enable webcam
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_enable_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_enable_button$
  #Checking Settings modal
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_settings_button$
    - Type: sleep
      Time: 2
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_settings_modal_title$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_settings_modal_mic_select$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_settings_modal_speakers_select$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_settings_modal_camera_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_settings_modal_close_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.video_settings_modal_close_button$
  #Opening new tab for the provider's part of the process
    - Type: new_tab
    - Type: switch_window
      Value: 1
    - Type: case
      Value: ProvidersCarePlatformLogin
    - Type: case
      Value: ProvidersCarePlatformEndCall
  #Switch back to the Employee Health Portal tab
    - Type: switch_window
      Value: 0
  #Wait for notification that call ended
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_call_ended$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_call_ended$

EmployeeHealthPortalAppointmentsRequest: 
  Roles:
    - Role: desktopChrome
      App: desktop       
  Actions: 
    # waiting for appointment view
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.request_appointment_button$
  # filling form
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.select_location_drop_down$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.select_location_option$
    - Type: generate_unique_name
      Name: "I have something to say about my health."
      ResultVar: PAIN_DESCRIPTION
    - Type: send_keys
      Strategy: id
      Id: $PAGE.employee_health_telehealth_request_form.comments$
      Value: $AND_CLI_PAIN_DESCRIPTION$
    # choosing Date and time
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.calendar_right_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.calendar_month_view$
    - Type: generate_random_day
      InsertedDay: $AND_CLI_DAY$
      ResultVar: DAY
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.calendar_day_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.calendar_hour_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.create_event_button$

#Employee Health Portal - User starts call from the EHP portal (this workflow won't end the call).
EmployeeHealthPortalCallNow:
  Vars:
    STATE: IN
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Home Page
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.call_now_button$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.call_now_button$
  #Telehealth on demand modal
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_title$
  #Fill all fields
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_state_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_state_select_option$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_patient_select$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_patient_select_option$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_reasons_input$
      Value: 'Test reason: automation'
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_call_provider_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_on_demand_modal.modal_call_provider_button$
    # Workaround starts here to see the on going call page.
    - Type: sleep
      Time: 2
    - Type: refresh
      Role: desktopChrome
    # Workaround ends here.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_on_demand_call_page.connecting_label$

# Custom action to log out of EHP if it is needed.
EmployeeHealthPortalLogOutAction:
  Environment: Settings
  Roles:
    - Role: desktopChrome
      App: desktop
  Actions:
    # Log out of EHP if needed.
    - Type: ehp_logout