#CXTB-242: Set “Notifications” in “My account” Modal
TestSettingNotification:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_tab$
  #Select Notification Tab
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_tab$
  #Verifying text in the notification tab
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_text$
      Greps:
        - var: TITLE_TEXT
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: TITLE_TEXT
          Value: Receive notifications 10 minutes before an appointment via
  #Checking that the checkboxes work: changes state with the click
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox_input$
      Greps:
      - var: ORIGINAL_EMAIL_VALUE
        attr: value
        match: "(.*)"
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox_input$
      Greps:
      - var: ORIGINAL_SMS_VALUE
        attr: value
        match: "(.*)"
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox_input$
      Greps:
      - var: NEW_EMAIL_VALUE
        attr: value
        match: "(.*)"
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox_input$
      Greps:
      - var: NEW_SMS_VALUE
        attr: value
        match: "(.*)"
    - Type: assert
      Asserts:
        - Type: ne
          Var: ORIGINAL_EMAIL_VALUE
          Value: $AND_CLI_NEW_EMAIL_VALUE$
    - Type: assert
      Asserts:
        - Type: ne
          Var: ORIGINAL_SMS_VALUE
          Value: $AND_CLI_NEW_SMS_VALUE$
  #Canceling changes. Modal should disappear.
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.cancel_button$
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
  #Going back to My Account and Notification Tab
    - Type: case
      Value: NavigateToMyAccount
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_tab$
  #Checking state got undone when we canceled
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox_input$
      Greps:
      - var: ORIGINAL_EMAIL_VALUE_2
        attr: value
        match: "(.*)"
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox_input$
      Greps:
      - var: ORIGINAL_SMS_VALUE_2
        attr: value
        match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: ORIGINAL_EMAIL_VALUE
          Value: $AND_CLI_ORIGINAL_EMAIL_VALUE_2$
    - Type: assert
      Asserts:
        - Type: eq
          Var: ORIGINAL_SMS_VALUE
          Value: $AND_CLI_ORIGINAL_SMS_VALUE_2$
  #Checking checkboxes
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_email_checkbox$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.notifications_sms_checkbox$
  #Saving
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.save_changes_button$
  #Waiting for notification of success
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_updated_notification$

#CXTB-252 Information & Update Contact Number
TestInformationUpdateNumber:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
  #Check that phone is the only one enable to edit, all the others are read only
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_input$ 
      Property: disabled
      Value: "false"
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_firstname_input$ 
      Property: disabled
      Value: "true"
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_lastname_input$ 
      Property: disabled
      Value: "true"
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_email_input$ 
      Property: disabled
      Value: "true"
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_date_of_birth_input$ 
      Property: disabled
      Value: "true"
    - Type: wait_for_property
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_member_id_input$ 
      Property: disabled
      Value: "true"
    #Save the current value for phone
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_input$
      Greps:
      - var: CURRENT_PHONE
        attr: value
        remove: '+1 '
        match: "(.*)"
    #The way to leave the phone input empty is by backspacing 10 times
    - Type: loop
      Times: 10
      Case: CaseDeletePhoneNumber
    - Type: wait_for_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_input$
      Attribute: value
      Value: ''
    #Trying to save with empty phone number input
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.save_changes_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_alert_message$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_alert_message$
      Greps:
        - var: PHONE_ALERT
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: PHONE_ALERT
          Value: Please enter a phone number
    #Checking alert when using wrong format
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_input$
      Value: 333666
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_alert_message$
      Greps:
        - var: PHONE_ALERT
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: PHONE_ALERT
          Value: Please enter a valid phone number
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_input$
      Value: 4444
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.save_changes_button$
  #Waiting for notification of success
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_updated_info$
    #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
    #Erase again the phone number
    - Type: loop
      Times: 10
      Case: CaseDeletePhoneNumber
    #Setting back the right value for phone number
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.my_info_phone_input$
      Value: $AND_CLI_employee_user1_phone_number$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.save_changes_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_updated_info$  

#CXTB-241 “Update password” Workflow in My account Modal
TestUpdateAccountPassword:
  Environment: Settings 
  Vars:
    ENV_PASS_STORE: $AND_CLI_employee_user1_pwd$ 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
    - Type: wait_for_page_to_load
      Time: 5
  #Go to Update Password tab and check components visibility
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_tab$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_new$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_confirm$
  #Try incorrect current password
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
      Value: "wrongPass!23"
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_new$
      Value: "Neural123!"
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_confirm$
      Value: "Neural123!"
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_change_button$
  #Wait for failure alert
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_failed_update_password$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_cancel_button$  
  #Verify the dialog is closed
    - Type: wait_not_visible
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
      Time: 5
  #Navigate into My Account
    - Type: case
      Value: NavigateToMyAccount
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.modal_title$
    - Type: wait_for_page_to_load
      Time: 5
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_tab$
  #Check requirements
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_requirements_link$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_requirements_text$  
  #Fill the fields correctly
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_current$
      Value: $AND_CLI_employee_user1_pwd$
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_new$
      Value: "Neural123!"
    - Type: send_keys
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_confirm$
      Value: "Neural123!"
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_my_account_modal.update_password_change_button$
  #Wait for success alert
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.alert_success_update_password$
  #Log Out
    - Type: case
      Value: EmployeeHealthPortalLogOut
  #Setting the password var to the new value
    - Type: set_env_var
      Value: Neural123!
      Var: employee_user1_pwd
  #Log In with new credentials
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Verify the login with the new password was successful
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.user_profile_contact_info$