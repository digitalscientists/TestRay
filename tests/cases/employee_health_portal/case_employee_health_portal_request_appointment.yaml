#CXTB-109 Employee Health Portal - Request an Appointment for User
TestEmployeeHealthPortalRequestAnAppointmentForUser:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Going to Request an Appointment
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.tab_section$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.request_appointment_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.form_modal$
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.create_event_button$
  # Checking error message
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.alert_location$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.alert_location$
      Greps:
        - var: ERROR_MESSAGE
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: ERROR_MESSAGE
          Value: Please select a state.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.alert_describe_reason$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.alert_describe_reason$
      Greps:
        - var: ERROR_MESSAGE
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: ERROR_MESSAGE
          Value: Please enter a reason for this request.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.alert_calendar$
    - Type: get_text
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.alert_calendar$
      Greps:
        - var: ERROR_MESSAGE
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: ERROR_MESSAGE
          Value: 'Please select a date. '
  # closing form
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.cancel_button$
  # make an appointment
    - Type: case
      Value: EmployeeHealthPortalAppointmentsRequest
  # Verify if the appointment is showing on the list
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.appointment_list$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_telehealth_request_form.appointment_list_description$
      Greps:
        - var: SHOWED_DESCRIPTION
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: SHOWED_DESCRIPTION
          Value: $AND_CLI_PAIN_DESCRIPTION$

#CXTB-113- Review Your Upcoming Appointments & Calendar for Employee EHP User accounts
TestEmployeeHealthPortalReviewUpcomingAppointment:
  Environment: Settings
  Roles: 
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: EmployeeHealthPortalLogIn
  #Creating many appointment
    - Type: loop
      Times: 3
      Case: EmployeeHealthPortalAppointmentsRequest
  # get the  upcoming appointment month
    - Type: get_next_month
      ResultVar: NEXT_MONTH
  #View information in "My schedule" tab on portal home page
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.schedule_tab_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$
  #validating upcoming scheduled event
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.upcoming_appointment_title$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.upcoming_appointment_title$
      Greps:
        - var: MANY_APPOINTMENTS
          attr: textContent
          condition: nempty
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: ne
          Var: MANY_APPOINTMENTS
          Value: 0 Upcoming Appointments
  #Checking first Date
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.first_day$
      Greps:
        - var: FIRST_SCHEDULED_DAY
          attr: datetime
          condition: nempty
          match: "(.*)"
    - Type: get_day
      Timestamp: $AND_CLI_FIRST_SCHEDULED_DAY$
      ResultVar: DAY
    # choosing Date
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_right_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_month_view$
    # checking first date introduced
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_day_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$
    # look for another day without even scheduled a date.
    - Type: generate_random_day
      ResultVar: DAY
    # checking a RandomDay
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_day_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$
    # Validate if there is a date scheduled
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.no_appointment_label$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.no_appointment_label$
      Greps:
        - var: NO_RESULT
          attr: textContent
          condition: nempty
          match: "No appointments(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: NO_RESULT
          Value: No appointments on this date
  # return to the upcoming appointment view
    - Type: sleep
      Time: 1
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.view_upcoming_appointment_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$
 # getting scheduled second day
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.second_day$
      Greps:
        - var: SECOND_SCHEDULED_DAY
          attr: datetime
          condition: nempty
          match: "(.*)"
    - Type: get_day
      Timestamp: $AND_CLI_SECOND_SCHEDULED_DAY$
      ResultVar: DAY
    # checking second day
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_day_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$
    # look for another day without even scheduled a date.
    - Type: generate_random_day
      ResultVar: Day
    # checking a RandomDay
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_day_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$
    # Validate if there is a date scheduled
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.no_appointment_label$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.no_appointment_label$
      Greps:
        - var: NO_RESULT
          attr: textContent
          condition: nempty
          match: "No appointments(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: NO_RESULT
          Value: No appointments on this date
  # return to the upcoming appointment view
    - Type: sleep
      Time: 1
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.view_upcoming_appointment_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$
  # getting third day scheduled
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.third_day$
      Greps:
        - var: THIRD_SCHEDULED_DAY
          attr: datetime
          condition: nempty
          match: "(.*)"
    - Type: get_day
      Timestamp: $AND_CLI_THIRD_SCHEDULED_DAY$
      ResultVar: DAY
    # checking third day
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_day_button$
    # look for another day without even scheduled a date.
    - Type: generate_random_day
      ResultVar: DAY
    # checking a RandomDay
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.calendar_day_button$
    # Validate if there is a date scheduled
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.no_appointment_label$
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.no_appointment_label$
      Greps:
        - var: NO_RESULT
          attr: textContent
          condition: nempty
          match: "No appointments(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: NO_RESULT
          Value: No appointments on this date
  # return to the upcoming appointment view
    - Type: sleep
      Time: 1
    - Type: click
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.view_upcoming_appointment_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.employee_health_home_page.container_tab$